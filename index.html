<!DOCTYPE html>

<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"/>
<title>Arapça Kelime Oyunları</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Harmattan:wght@400;700&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Marhey:wght@400;700&amp;family=Harmattan:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Marhey:wght@400;700&display=swap" rel="stylesheet">
<style>
        html {
            /* Font boyutu minimum 12px olsun (çok küçük telefonlar için),
               Tercihen ekran genişliğinin %1.2'si kadar olsun,
               Maksimum 18px olsun (çok büyük 4K monitörlerde devasa görünmesin).
            */
            font-size: clamp(12px, 1.2vw, 18px);
        }

        :root {
            --bg-start: #f7f9fc;
            --bg-end: #e8eef5;
            --primary-color: #5E81AC; /* Yumuşak mavi */
            --accent-color: #f7b733; /* Yumuşak sarı */
            --surface-color: #FFFFFF;
            --text-color: #2e3440; /* Daha koyu ve net metin rengi */
            --text-light-color: #FFFFFF;
            --player1-color: #64a7fa; /* Daha canlı oyuncu 1 rengi */
            --player2-color: #f77d7d; /* Daha canlı oyuncu 2 rengi */
            --correct-color: #2ddc73; /* Süper Canlı Yeşil */
            --incorrect-color: #f24c4c; /* Süper Canlı Kırmızı */
            --shadow-light: rgba(46, 52, 64, 0.07);
            --shadow-medium: rgba(46, 52, 64, 0.12);
            --border-radius-sm: 8px;
            --border-radius-md: 16px;
            --border-radius-lg: 24px;
            --unit1-color-light: #dbe7ff;
            --unit1-color-dark: #a0c4ff;
            --unit2-color-light: #e6ffde;
            --unit2-color-dark: #caffbf;
            --unit3-color-light: #feffda;
            --unit3-color-dark: #fdffb6;
            --unit4-color-light: #ffdddd;
            --unit4-color-dark: #ffadad;
            --grade9-bg: #eaf2f8; /* Pastel Gri-Mavi */
            --grade10-bg: #e8f8f5; /* Pastel Nane Yeşili */
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            font-family: 'Marhey';
            background-color: var(--bg-start);
            background-image: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
            color: var(--text-color);
            text-align: center;
            text-rendering: optimizeLegibility;
        }

        #game-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
        }

        button, input {
            font-family: 'Marhey';
        }


        .screen { display: none; width: 100%; height: 100%; padding: 15px; flex-direction: column; justify-content: center; align-items: center; position: absolute; top: 0; left: 0; transition: opacity 0.5s; }
        .screen.active { display: flex; }

        #main-menu-screen {
            gap: 15px;
            justify-content: center;
            overflow-y: auto; /* Dikey scroll eklendi */
            padding-bottom: 80px; /* Altta boşluk bırakmak için */
        }
        #main-menu-screen::before, #main-menu-screen::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            filter: blur(150px);
            z-index: -1;
        }
        #main-menu-screen::before {
            width: 35vw; height: 35vw; min-width: 350px; min-height: 350px;
            background-color: rgba(100, 167, 250, 0.3);
            top: -15%; left: -15%;
        }
        #main-menu-screen::after {
            width: 45vw; height: 45vw; min-width: 450px; min-height: 450px;
            background-color: rgba(247, 125, 125, 0.25);
            bottom: -25%; right: -20%;
        }

        .main-title { font-size: clamp(2.2rem, 5vw, 3rem); color: var(--text-color); margin: 20px 0 10px 0; flex-shrink: 0; }

        .main-content-grid {
            display: grid;
            grid-template-columns: 1fr; /* Tek sütuna döndürüldü */
            justify-items: center; /* İçerik ortalandı */
            gap: 20px;
            width: 100%;
            max-width: 1700px;
            align-items: start; /* Üstten başlaması için */
        }
        .selection-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 0;
            width: 100%;
            align-items: center;
        }
        .start-action-wrapper {
           display: none; /* Düğme taşındığı için bu alan gizlendi */
        }

        .grades-container {
            display: flex;
            flex-direction: row; /* Değiştirildi: Yan Yana Hizalama */
            gap: 20px; /* Sınıflar arası yatay boşluk */
            overflow-y: visible; /* Scroll ana ekrana taşındı */
            padding: 5px;
            justify-content: center;
            flex-wrap: wrap; /* Küçük ekranlarda alt alta gelmesi için */
        }

        .grade-column {
            padding: 20px;
            border-radius: var(--border-radius-lg);
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow: visible;
            flex-shrink: 0; /* Küçülmesini engelle */
            width: calc(50% - 10px); /* İki sütun için */
            min-width: 350px; /* Minimum genişlik */
        }
        .grade-column.grade-9 {
            background-color: var(--grade9-bg);
        }
        .grade-column.grade-10 {
            background-color: var(--grade10-bg);
        }
        .grade-header {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e9f0;
            flex-shrink: 0;
            text-align: center;
            margin-bottom: 0px;
        }

        .units-container {
            display: grid;
            grid-template-columns: 1fr; /* Tek sütun */
            gap: 10px; /* Üniteler arası boşluk */
            flex-grow: 1;
            padding: 1px;
        }
        .unit-panel { /* details etiketi */
            border: none;
            border-radius: var(--border-radius-md);
            background-color: rgba(255,255,255,0.5); /* Hafif arka plan */
            transition: background-color 0.2s;
        }
        .unit-panel[open] {
            background-color: white;
            box-shadow: 0 4px 15px var(--shadow-light);
        }
        .unit-panel summary { /* Ünite başlığı */
            font-size: 1.6rem;
            font-weight: 600;
            padding: 10px 15px; /* İç boşluk */
            border-radius: var(--border-radius-md);
            color: var(--text-color);
            cursor: pointer;
            list-style: none; /* Varsayılan oku kaldır */
            transition: background-color 0.2s;
            outline: none; /* Odaklanma çerçevesini kaldır */
        }
        .unit-panel summary::-webkit-details-marker { display: none; } /* Safari için oku kaldır */
        .unit-panel[open] > summary {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            font-weight: 700; /* Açıkken daha belirgin */
        }

        .lessons-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px; /* Dersler arası boşluk eklendi */
            background-color: transparent;
            border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
            overflow: visible;
            box-shadow: none;
            padding: 10px 15px 15px 15px; /* İç boşluklar güncellendi */
        }

        .lesson-btn {
            font-size: 1.4rem; /* Biraz küçültüldü */
            padding: 8px 12px; /* Biraz küçültüldü */
            border: none;
            background-color: var(--bg-start);
            cursor: pointer;
            transition: all 0.15s ease-out;
            text-align: left;
            height: auto;
            min-height: 25px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            border-radius: var(--border-radius-sm);
            box-shadow: 0 3px #d8dee9;
        }
        .lesson-btn:hover:not(.selected) {
            transform: translateY(-2px);
            box-shadow: 0 5px #d8dee9;
        }
        .lesson-btn:active {
            transform: translateY(2px); /* Tıklama efekti */
            box-shadow: 0 1px #d8dee9; /* Tıklama efekti gölgesi */
        }
        .lessons-container .lesson-btn:last-child {
            border-bottom: none;
        }
        .lesson-btn.selected {
            color: var(--text-color);
            font-weight: bold;
            transform: scale(1.03);
            border: none;
            box-shadow: 0 0 0 3px var(--correct-color), 0 0 15px rgba(45, 220, 115, 0.5);
        }

        /* Unit Colors - Summary Backgrounds */
        .unit-1 summary { background-color: var(--unit1-color-light); }
        .unit-1 .lesson-btn:hover { background-color: var(--unit1-color-light); }
        .unit-1 .lesson-btn.selected { background-color: var(--unit1-color-dark); }
        .unit-1[open] > summary { background-color: var(--unit1-color-dark); color: var(--text-color); }

        .unit-2 summary { background-color: var(--unit2-color-light); }
        .unit-2 .lesson-btn:hover { background-color: var(--unit2-color-light); }
        .unit-2 .lesson-btn.selected { background-color: var(--unit2-color-dark); }
        .unit-2[open] > summary { background-color: var(--unit2-color-dark); color: var(--text-color); }

        .unit-3 summary { background-color: var(--unit3-color-light); }
        .unit-3 .lesson-btn:hover { background-color: var(--unit3-color-light); }
        .unit-3 .lesson-btn.selected { background-color: var(--unit3-color-dark); }
        .unit-3[open] > summary { background-color: var(--unit3-color-dark); color: var(--text-color); }

        .unit-4 summary { background-color: var(--unit4-color-light); }
        .unit-4 .lesson-btn:hover { background-color: var(--unit4-color-light); }
        .unit-4 .lesson-btn.selected { background-color: var(--unit4-color-dark); }
        .unit-4[open] > summary { background-color: var(--unit4-color-dark); color: var(--text-color); }


        .actions-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: flex-start;
            width: 100%; /* Genişlik eklendi */
            max-width: 720px; /* Ders listeleriyle aynı genişlikte */
            padding: 0; /* Kenar boşluğu eklendi */
            align-self: center; /* Ortalamak için */
        }

        .game-selection-panel {
            background: transparent;
            padding: 0;
            box-shadow: none;
            border: none;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        .game-selection-panel h3 {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            padding-bottom: 10px;
            border-bottom: 3px solid #e5e9f0;
            flex-shrink: 0;
            text-align: center;
            margin: 0 0 10px 0;
        }

        #game-selector-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Min buton genişliği ayarlandı */
            gap: 10px;
            flex-grow: 1;
        }


        .menu-btn {
            background-color: var(--surface-color);
            color: var(--text-color);
            border: none;
            padding: 8px; /* Biraz artırıldı */
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px; /* Biraz artırıldı */
            position: relative;
            gap: 5px;
            box-shadow: 0 4px 15px var(--shadow-light);
        }
        .menu-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        .menu-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--shadow-light);
        }
        .menu-btn.selected {
            border: 3px solid var(--correct-color);
            box-shadow: 0 0 15px rgba(45, 220, 115, 0.5);
            transform: scale(0.95); /* Biraz büyütüldü */
        }
        .menu-btn svg {
            width: 32px;
            height: 32px;
            fill: var(--accent-color);
        }
        .menu-btn .menu-title {
            font-size: 1.3rem;
            font-weight: bold;
            line-height: 1.3; /* Biraz azaltıldı */
        }

        #start-game-btn {
             grid-column: 1 / -1; /* Tüm sütunları kapla */
             font-size: 1.8rem;
             font-weight: bold;
             padding: 10px;
             min-height: auto;
             width: 100%;
             margin-top: 10px; /* Üstten boşluk artırıldı */
             border: none;
             text-orientation: initial; /* Dikey yazı kaldırıldı */
             border-radius: var(--border-radius-md);
        }
         #start-game-btn:disabled {
            background-color: var(--primary-color);
            opacity: 0.5;
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
            animation: none;
         }
         #start-game-btn:not(:disabled) {
            background-color: var(--correct-color);
            color: white;
            box-shadow: 0 5px 20px rgba(45, 220, 115, 0.4);
            animation: button-glow 2s infinite ease-in-out;
         }

        .header-navigation { position: absolute; top: 20px; left: 20px; z-index: 200; }
        .back-btn { background: none; border: none; cursor: pointer; padding: 5px; }
        .back-btn svg { width: 40px; height: 40px; fill: var(--text-color); transition: all 0.2s; opacity: 0.8; filter: drop-shadow(0 1px 2px var(--shadow-light)); }
        .back-btn:hover svg { opacity: 1; transform: scale(1.1); }
        .hidden { display: none !important; }

        #game-screen { flex-direction: row; justify-content: space-between; padding: 20px; align-items: stretch; overflow: hidden; }

        .score-display {
            flex: 0 0 15%;
            max-width: 150px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
            font-size: clamp(3rem, 6vw, 4rem);
            font-weight: bold;
            transition: all 0.4s ease;
            opacity: 0.9;
            border-radius: var(--border-radius-lg);
            color: var(--text-light-color);
            border: none;
        }
        #player1-display { background: linear-gradient(180deg, var(--player1-color), #4e8dff); }
        #player2-display { background: linear-gradient(180deg, var(--player2-color), #f55a5a); }
        .score-display svg { width: 80px; height: 80px; fill: rgba(255,255,255,0.9); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));}

        .score-display.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 0 35px -5px var(--shadow-color);
        }
        #player1-display.active { box-shadow: 0 0 35px -5px var(--player1-color); }
        #player2-display.active { box-shadow: 0 0 35px -5px var(--player2-color); }

        #game-board {
            flex-grow: 1;
            width: 100%;
            margin: 0;
            padding: 0 15px;
            display: grid;
            gap: clamp(8px, 1vw, 15px);
            perspective: 1200px;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            height: 100%;
        }
        .card { background-color: transparent; cursor: pointer; container-type: inline-size; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: var(--border-radius-md);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
            word-break: break-word;
            font-size: clamp(1.8rem, 20cqw, 5rem);
            text-align: center;
            line-height: 1.1;
        }
        .card-front { background-color: var(--surface-color); box-shadow: 0 2px 8px var(--shadow-light); }
        .card-back { color: var(--text-light-color); transform: rotateY(180deg); background-color: var(--primary-color);}
        .card.p1-turn .card-back { background-color: var(--player1-color); }
        .card.p2-turn .card-back { background-color: var(--player2-color); }
        .card.p1-match .card-face.card-back { background-color: var(--player1-color); }
        .card.p2-match .card-face.card-back { background-color: var(--player2-color); }

        .game-over-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--surface-color);
            padding: 30px 50px;
            border-radius: var(--border-radius-lg);
            border: none;
            z-index: 200;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .game-start-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(46, 52, 64, 0.7);
            backdrop-filter: blur(5px);
            z-index: 150;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-over-overlay h2 { font-size: 2.5rem; margin: 0; }
        #winner-icon-container, #quiz-winner-icon-container, #typing-winner-icon-container { display: flex; justify-content: center; gap: 10px; }
        #winner-icon-container svg, #quiz-winner-icon-container svg, #typing-winner-icon-container svg { width: 80px; height: 80px; }
        #memory-win-text.p1-win, #quiz-win-text.p1-win, #typing-win-text.p1-win { color: var(--player1-color); }
        #winner-icon-container.p1-win svg, #quiz-winner-icon-container.p1-win svg, #typing-winner-icon-container.p1-win svg { fill: var(--player1-color); }
        #memory-win-text.p2-win, #quiz-win-text.p2-win, #typing-win-text.p2-win { color: var(--player2-color); }
        #winner-icon-container.p2-win svg, #quiz-winner-icon-container.p2-win svg, #typing-winner-icon-container.p2-win svg { fill: var(--player2-color); }
        #memory-win-text.draw, #quiz-win-text.draw, #typing-win-text.draw { color: var(--accent-color); }
        #winner-icon-container.draw svg, #quiz-winner-icon-container.draw svg, #typing-winner-icon-container.draw svg { width: 60px; height: 60px; }
        #winner-icon-container.draw svg:first-child, #quiz-winner-icon-container.draw svg:first-child, #typing-winner-icon-container.draw svg:first-child { fill: var(--player1-color); }
        #winner-icon-container.draw svg:last-child, #quiz-winner-icon-container.draw svg:last-child, #typing-winner-icon-container.draw svg:last-child { fill: var(--player2-color); }

        .win-buttons { display: flex; gap: 40px; margin-top: 20px; }
        .win-buttons .icon-btn { background-color: transparent; border: none; cursor: pointer; transition: all 0.3s ease; }
        .win-buttons .icon-btn:hover { transform: scale(1.1); }
        .win-buttons .icon-btn svg { width: 56px; height: 56px; fill: var(--primary-color); }
        .win-buttons .icon-btn:hover svg { fill: var(--accent-color); }

        #quiz-screen { padding: 20px; gap: 20px; position: relative; justify-content: center; align-items: center; }

        #quiz-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            width: 90%;
            height: 90%;
            max-width: 1500px;
            position: relative;
        }
        #quiz-container::after {
            content: '';
            position: absolute;
            top: 5%;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            background-color: rgba(0,0,0,0.08);
            border-radius: 2px;
        }

        #quiz-start-btn {
            font-size: 6rem;
            padding: 25px 80px;
            border-radius: var(--border-radius-lg);
            border: none;
            background-color: var(--correct-color);
            color: white;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(45, 220, 115, 0.5);
            animation: wave-pulse 2s infinite ease-in-out;
            transform: scale(1.2);
        }

        .quiz-player-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; gap: 15px; border-radius: var(--border-radius-lg); transition: transform 0.5s, box-shadow 0.5s; position: relative; }
        .score-effects-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; overflow: hidden; border-radius: var(--border-radius-lg); }
        .score-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--text-light-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            padding: 5px 15px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: float-up-and-fade 2s ease-out forwards;
        }
        .score-effect.bonus { z-index: 101; }
        .burst-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .particle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            margin-top: -5px;
            margin-left: -5px;
            background-color: var(--accent-color);
            border-radius: 50%;
            opacity: 0;
            animation: burst 1.2s ease-out;
        }
        @keyframes burst {
            0% { transform: rotate(var(--angle)) translateY(20px) scale(1); opacity: 1; }
            100% { transform: rotate(var(--angle)) translateY(120px) scale(0); opacity: 0; }
        }

        .score-effect svg { width: 32px; height: 32px; fill: white; filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5)); }
        @keyframes float-up-and-fade {
            0% { transform: translate(-50%, 0); opacity: 1; }
            100% { transform: translate(-50%, -300px); opacity: 0; }
        }
        .quiz-player-area.shake { animation: shake 0.5s; }
        .quiz-option-btn.shake { animation: shake 0.5s; }

        .quiz-top-bar {
            display: flex;
            width: 100%;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
            padding: 0 10px;
        }

        .quiz-game-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            height: 100%;
        }

        .quiz-player-area .quiz-progress {
            font-size: 1.8rem;
            color: var(--text-color);
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .quiz-score-display { display: flex; align-items: center; gap: 8px; }
        .quiz-score-display svg { width: 32px; height: 32px; fill: var(--accent-color); }
        .quiz-player-area .progress-bar {
            flex-grow: 1;
            margin: 0;
            flex-direction: row-reverse; /* Sağdan sola ilerleme eklendi */
        }

        .quiz-player-area .quiz-question {
            font-size: clamp( 2.8rem, 15cqw, 3.8rem);
            font-weight: bold;
            padding: 20px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-md);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 15px;
            direction: rtl;
            container-type: inline-size;
        }
        .quiz-player-area .quiz-options { display: grid; grid-template-columns: 1fr; gap: 10px; width: 100%; flex-grow: 1; transition: opacity 0.3s; }

        .quiz-player-area .quiz-option-btn {
            font-family: inherit;
            border: 2px solid;
            color: var(--text-color);
            font-size: clamp(1.7rem, 4vw, 2.4rem);
            font-weight: bold;
            padding: 15px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 8px var(--shadow-light);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            text-align: center;
            direction: ltr;
        }
        .quiz-option-btn.selected { transform: scale(1.02); }
        .p1 .quiz-option-btn.selected { border-color: var(--player1-color); box-shadow: 0 4px 10px rgba(100, 167, 250, 0.4); }
        .p2 .quiz-option-btn.selected { border-color: var(--player2-color); box-shadow: 0 4px 10px rgba(247, 125, 125, 0.4); }

        .quiz-option-btn.correct {
            background-color: var(--correct-color) !important;
            border-color: var(--correct-color) !important;
            color: var(--text-light-color) !important;
            transform: scale(1.03);
        }
        .quiz-option-btn.incorrect {
            background-color: var(--incorrect-color) !important;
            border-color: var(--incorrect-color) !important;
            color: var(--text-light-color) !important;
            transform: scale(1.03);
        }

        .quiz-option-btn:disabled { cursor: not-allowed; opacity: 0.7; }

        .quiz-option-btn.correct:disabled,
        .quiz-option-btn.incorrect:disabled {
            opacity: 1;
        }

        .quiz-player-area.p1 { background-color: rgba(100, 167, 250, 0.1); }
        .quiz-player-area.p1 .quiz-option-btn {
            background-color: #f0f6ff;
            border-color: #d1e3ff;
        }
        .quiz-player-area.p1 .quiz-option-btn:hover:not(:disabled) {
            background-color: #e2eeff;
            border-color: var(--player1-color);
            transform: translateY(-2px);
        }
        .quiz-player-area.p1 .quiz-option-btn-icon { fill: var(--player1-color); }

        .quiz-player-area.p2 { background-color: rgba(247, 125, 125, 0.1); }
        .quiz-player-area.p2 .quiz-option-btn {
            background-color: #fff0f0;
            border-color: #ffd6d6;
        }
        .quiz-player-area.p2 .quiz-option-btn:hover:not(:disabled) {
            background-color: #ffe4e4;
            border-color: var(--player2-color);
            transform: translateY(-2px);
        }
        .quiz-player-area.p2 .quiz-option-btn-icon { fill: var(--player2-color); }

        #match-screen { justify-content: center; padding-top: 20px; gap: 20px; overflow: hidden; }
        .match-container { display: flex; flex-direction: row-reverse; gap: 20px; width: 100%; max-width: 1200px; flex-grow: 1; padding-bottom: 20px; }
        .match-column { flex: 1; display: flex; flex-direction: column; gap: 8px; justify-content: space-around; }
        .match-item, .match-target {
            font-family: inherit;
            font-size: clamp(1.5rem, 3vw, 2.4rem);
            padding: 12px;
            border-radius: var(--border-radius-md);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70px;
        }
        .match-item { background: var(--surface-color); border: none; cursor: grab; box-shadow: 0 4px 15px var(--shadow-light); direction: rtl; transition: opacity 0.2s ease, box-shadow 0.2s ease;}
        .match-target { background: rgba(0,0,0,0.02); border: 2px dashed #d8dee9; direction: ltr; transition: all 0.2s ease; }
        .match-item.dragging { opacity: 0.5; box-shadow: 0 8px 25px var(--shadow-medium); }
        .match-target.drag-over { border-color: var(--accent-color); border-style: solid; background-color: rgba(247, 183, 51, 0.1); }
        .match-item.correct-match, .match-target.correct-match {
            background-color: var(--correct-color);
            border-color: var(--correct-color);
            color: white;
            cursor: default;
            opacity: 0.8;
            transform: scale(0.98);
            transition: all 0.3s ease;
        }
        .match-item.correct-match { box-shadow: none; }
        .match-target.incorrect-flash { animation: flash-red 0.5s; }
        @keyframes flash-red { from, to { background-color: rgba(0,0,0,0.02); } 50% { background-color: var(--incorrect-color); } }
        #match-complete-overlay .icon-btn { background-color: transparent; border: none; cursor: pointer; transition: transform 0.3s ease; }
        #match-complete-overlay .icon-btn:hover { transform: scale(1.1); }
        #match-complete-overlay .icon-btn svg { width: 120px; height: 120px; fill: var(--primary-color); animation: pulse-glow 1.5s infinite ease-in-out; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3)); }

        #typing-screen { flex-direction: row; align-items: center; justify-content: center; padding: 20px; gap: 20px; position: relative;}

        #typing-main-container { display: flex; width: 100%; max-width: 1400px; gap: 20px; align-items: stretch; }
        #typing-status-panel {
            flex: 1;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-md);
            padding: 20px;
            align-self: stretch;
            box-shadow: 0 4px 15px var(--shadow-light);
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 40px);
        }
        #typing-status-panel h2 {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 2px solid #e5e9f0;
            padding-bottom: 10px;
            flex-shrink: 0;
            text-align: center;
        }
        #typing-status-list {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: left;
            flex-grow: 1;
            overflow-y: auto;
        }
        #typing-status-list li { padding: 15px; margin-bottom: 10px; border-radius: var(--border-radius-sm); border-left-width: 5px; border-left-style: solid; transition: background-color 0.3s; }
        #typing-status-list li.correct { background-color: rgba(143, 188, 143, 0.1); border-left-color: var(--correct-color); }
        #typing-status-list li.incorrect { background-color: rgba(240, 128, 128, 0.1); border-left-color: var(--incorrect-color); }
        .status-word { font-weight: bold; font-size: 2.1rem; direction: rtl; text-align: right; }
        .status-translation { color: #4c566a; margin-bottom: 5px; font-size: 1.5rem;}
        .status-user-answer { font-style: italic; color: var(--incorrect-color); direction: rtl; text-align: right; font-size: 1.7rem;}
        .status-user-answer::before { content: "Cevabın: "; font-style: normal; font-size: 1.5rem; }

        #typing-game-area { flex: 2; display: flex; flex-direction: column; align-items: center; gap: 20px; justify-content: center; position: relative;}
        #typing-interactive-elements {
            width: 100%;
            max-width: 800px; /* Genişliği klavye ile eşitlemek için eklendi */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .countdown-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(46, 52, 64, 0.85); z-index: 200; display: none; justify-content: center; align-items: center; font-size: clamp(8rem, 30vw, 15rem); font-weight: bold; color: var(--accent-color); text-shadow: 0 0 15px rgba(247, 183, 51, 0.5);}
        .typing-stats { display: flex; justify-content: space-around; align-items: center; width: 100%; font-size: 1.8rem; gap: 20px; }
        .stat-item { position: relative; display: flex; align-items: center; gap: 10px; background-color: var(--surface-color); padding: 8px 15px; border-radius: var(--border-radius-md); transition: all 0.3s; box-shadow: 0 2px 8px var(--shadow-light); }
        .score-effects-container-typing { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; overflow: visible; }
        .typing-score-effect {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--correct-color);
            text-shadow: 1px 1px 2px rgba(255,255,255,0.7);
            animation: pop-up-and-fade 1.5s ease-out forwards;
        }
        @keyframes pop-up-and-fade {
            0% { transform: translate(-50%, 0) scale(0.5); opacity: 1; }
            50% { transform: translate(-50%, -60px) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -80px) scale(0.8); opacity: 0; }
        }
        .stat-item svg { width: 32px; height: 32px; fill: var(--primary-color); }
        .progress-bar { display: flex; gap: 4px; width: 100%; height: 10px; }
        #typing-progress-bar { flex-direction: row-reverse; }
        .progress-segment { flex: 1; background-color: #e5e9f0; border-radius: 5px; transition: all 0.3s ease; }
        .progress-segment.correct { background-color: var(--correct-color); }
        .progress-segment.incorrect { background-color: var(--incorrect-color); }
        .progress-segment.active { background-color: var(--accent-color); transform: scaleY(1.5); }
        #typing-prompt { direction: rtl; font-size: clamp(3rem, 8vw, 5.5rem); font-weight: bold; background-color: var(--surface-color); border-radius: var(--border-radius-lg); min-height: 150px; display: flex; align-items: center; justify-content: center; width: 100%; box-shadow: 0 4px 15px var(--shadow-light);}
        .typing-input-area { display: flex; align-items: stretch; gap: 10px; width: 100%; flex-direction: row; }
        #typing-input { font-size: 2.2rem; flex-grow: 1; padding: 15px; border-radius: var(--border-radius-md); border: 2px solid #d8dee9; background: var(--surface-color); color: var(--text-color); text-align: right; direction: rtl; transition: box-shadow 0.2s, border-color 0.2s; }
        #typing-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(94, 129, 172, 0.2); }
        #typing-input:disabled { background-color: #eceff4; cursor: not-allowed; }
        #typing-input.correct-input { border-color: var(--correct-color); }
        #typing-input.incorrect-input { border-color: var(--incorrect-color); animation: shake 0.5s; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        #typing-submit-btn {
            border: none;
            background-color: var(--correct-color);
            color: var(--text-light-color);
            border-radius: var(--border-radius-md);
            padding: 0;
            flex-basis: 100px; /* Dengelemek için temel genişlik ayarlandı */
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #6e9b6e;
            animation: flash-confirm 1.2s infinite ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #typing-submit-btn:hover { background-color: #8fbc8f; }
        #typing-submit-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #6e9b6e; }
        #typing-submit-btn svg { width: 32px; height: 32px; fill: white; pointer-events: none; }

        #virtual-keyboard { direction: rtl; padding: 10px; display: flex; flex-direction: column; gap: 8px; background-color: rgba(0,0,0,0.03); border-radius: var(--border-radius-md); width: 100%; max-width: 800px; transition: all 0.3s; }
        .keyboard-row { display: flex; justify-content: center; gap: 8px; }
        .keyboard-key {
            font-family: 'Harmattan';
            color: var(--text-color);
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 2.0rem;
            padding: 12px 6px;
            cursor: pointer;
            transition: all 0.1s ease;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .keyboard-key:active { transform: translateY(2px); }
        .keyboard-key.backspace { background-color: var(--accent-color); }
        .keyboard-key svg { width: 24px; height: 24px; fill: var(--text-color); pointer-events: none;}
        .keyboard-key.space-bar {
            position: relative;
        }

        #typing-game-over .icon-btn { animation: pulse-glow 1.5s infinite ease-in-out; }
        #typing-game-over .icon-btn svg { width: 80px; height: 80px;}

        #typing-prompt.start-mode {
            background-color: var(--incorrect-color);
            color: var(--text-light-color);
            cursor: pointer;
            animation: wave-pulse 2s infinite ease-in-out;
            font-family: 'Harmattan';
            font-weight: 700;
            font-size: clamp(3rem, 7vw, 4.5rem);
        }

        .results-screen { padding-top: 80px; }
        .results-screen.match-complete {
            padding-top: 0;
            justify-content: center;
        }
        .results-screen.match-complete .win-buttons {
            margin-top: 0;
        }
        .results-screen.match-complete .header-navigation {
            /* display: none; */ /* Bu kural kaldırıldı */
        }

        .results-screen h2 { font-size: 4rem; margin-bottom: 25px; }
        .results-screen p { font-size: 2.5rem; color: var(--accent-color); margin-top: 0; }

        #results-details { text-align: left; width: 90%; max-width: 800px; max-height: 45vh; overflow-y: auto; background: var(--surface-color); padding: 30px; border-radius: var(--border-radius-md); }
        #results-details h3 { font-size: 2.2rem; margin-bottom: 20px; }
        #results-details ul { list-style: none; padding: 0; margin: 0; }
        #results-details li { margin-bottom: 25px; font-size: 2.2rem; line-height: 1.7; padding-bottom: 20px; border-bottom: 1px solid #e5e9f0; }
        #results-details li:last-child { border-bottom: none; }
        #results-details .prompt { font-weight: bold; direction: rtl; display: inline-block; }
        #results-details .user-answer { color: var(--incorrect-color); text-decoration: line-through; background-color: rgba(240, 128, 128, 0.2); padding: 5px 10px; border-radius: var(--border-radius-sm); direction: rtl; display: inline-block; }
        #results-details .correct-answer { color: var(--correct-color); background-color: rgba(143, 188, 143, 0.2); padding: 5px 10px; border-radius: var(--border-radius-sm); direction: rtl; display: inline-block; }

        @keyframes pulse-glow { 0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(94, 129, 172, 0.2)); }
                                     50% { transform: scale(1.05); filter: drop-shadow(0 0 20px rgba(94, 129, 172, 0.6));} }

        @keyframes wave-pulse {
            0% {
                transform: scale(0.5);
                box-shadow: 0 5px 5px var(--shadow-light);
            }
            50% {
                transform: scale(0.5);
                box-shadow: 0 5px 5px rgba(242, 76, 76, 0.5);
            }
            100% {
                transform: scale(0.5);
                box-shadow: 0 5px 5px var(--shadow-light);
            }
        }

        @keyframes flash-confirm {
            50% {
                background-color: #28a745; /* Slightly darker green */
                transform: scale(1.02);
            }
        }

        /* neon-glow-pulse ve highlight-space animasyonları kaldırıldı */

        #orientation-warning {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-start);
            color: var(--text-color);
            text-align: center;
            padding: 20px;
            z-index: 9999;
        }

        #orientation-warning svg {
            width: 80px;
            height: 80px;
            fill: var(--primary-color);
            margin-bottom: 20px;
            animation: rotate-anim 2s infinite ease-in-out;
        }

        #orientation-warning h2 {
            font-size: 2rem;
        }

        @keyframes rotate-anim {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-90deg); }
            100% { transform: rotate(-90deg); }
        }

        @keyframes button-glow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(45, 220, 115, 0.5);
            }
            50% {
                box-shadow: 0 0 25px rgba(45, 220, 115, 0.8);
            }
        }

        @keyframes breathing-effect {
             0%, { transform: scale(0.7); }
             50% { transform: scale(0.8); }
             100% { transform: scale(0.9); }
        }

        .game-selection-panel.highlight .menu-btn {
            animation: breathing-effect 2s infinite ease-in-out;
        }


        @media (max-width: 1200px) {
            #typing-main-container { flex-direction: column; height: auto; }
            #typing-status-panel { width: 100%; flex: none; height: 250px; }
            #typing-game-area { width: 100%; }
            #quiz-screen { flex-direction: column; }
            #quiz-container { flex-direction: column; gap: 10px; height: 95%; }
            #quiz-container::after { display: none; }
            .main-content-grid { grid-template-columns: 1fr; }
            .actions-column { flex-direction: row; align-items: stretch; }
            .grades-container { flex-direction: column; align-items: center;} /* Sütunları alt alta getir */
            .grade-column { width: 100%; max-width: 720px; } /* Genişliği ayarla */
        }
        @media (max-width: 800px) {
             #game-screen { flex-direction: column; padding-top: 20px; }
             .score-display { flex-direction: row; height: 80px; width: 100%; max-width: none; }
             #game-board { flex-grow: 1; margin: 10px 0; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, 1fr); }
             .quiz-player-area .quiz-options { grid-template-columns: 1fr; }
             .match-item, .match-target { font-size: 1.2rem; padding: 8px;}
             .keyboard-key { font-size: 1.1rem; padding: 8px 4px; }
             #game-selector-container { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); } /* Mobil için daha küçük butonlar */
             .actions-column { flex-direction: column;} /* Küçük ekranda alt alta */
        }


           .game-selection-panel h3 {
              background: linear-gradient(90deg, #ff66c4, #ffde59, #81d45e, #00c9ff, #7b53cb);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              font-weight: bold;
              animation: rainbow-shift 5s linear infinite;
            }

            @keyframes rainbow-shift {
              0% { background-position: 0% 50%; }
              100% { background-position: 100% 50%; }
            }
            /* 🎨 Eşleştirme Oyunu Yazı Tipi */
            .match-item,
            .match-target,
            #match-game,
            #match-game * {
              font-family: 'Marhey', sans-serif !important;
            }

            /* Başta kilitli */
            .menu-btn.locked{
              opacity:.5;
              pointer-events:none !important;
              color:rgba(0,0,0,.4);
              filter:grayscale(.2);
              transition:opacity .25s ease, color .25s ease;
            }

            /* Ders seçilince aç */
            .menu-btn.unlocked{
              opacity:1;
              pointer-events:auto !important;
              color:#000;
            }



</style>

<style>
    /* Metin taşmasını engelleme */
    summary, /* Ünite başlıkları için */
    .lesson-btn,
    .menu-btn .menu-title,
    .match-item,
    .match-target,
    .quiz-option-btn,
    .quiz-question,
    #typing-prompt {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block; /* Ellipsis'in çalışması için block veya inline-block gerekli */
    }

    /* Flex container'daki metnin sığması için */
    .menu-btn > div {
        min-width: 0;
    }

</style>
<style>
/* === Font system override === */
html, body {
  font-family: 'Marhey', sans-serif !important;
}

/* Arabic blocks use Harmattan */
[dir="rtl"],
.arabic-text,
.quiz-question,
#typing-prompt,
.status-word,
.match-item, /* Eşleştirme için eklendi */
/*.match-target,*/ /* Türkçe kalabilir */
.keyboard-key {
  font-family: 'Harmattan', sans-serif !important;
}

/* Common UI — Turkish labels, buttons, headers use Marhey */
button, input,
.lesson-btn,
.menu-btn .menu-title,
.grade-header,
summary, /* Ünite başlıkları için */
#start-game-btn,
h1, h2, h3, h4, h5, h6,
.match-target /* Türkçe eşleşmeler için Marhey */
{
  font-family: 'Marhey', sans-serif !important;
}
</style></head>
<body>
<div id="orientation-warning">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16.89,15.5L18.31,16.92C19.21,15.75 19.76,14.43 19.93,13H17.91C17.77,13.89 17.42,14.73 16.89,15.5M16.92,18.31L15.5,16.89C14.73,17.42 13.89,17.77 13,17.91V19.93C14.43,19.76 15.75,19.21 16.92,18.31M19.93,11H17.91C17.77,10.11 17.42,9.27 16.89,8.5L18.31,7.08C19.21,8.25 19.76,9.57 19.93,11M13,4.07V6.09C12.11,6.23 11.27,6.58 10.5,7.11L9.08,5.69C10.25,4.79 11.57,4.24 13,4.07M2,4.27L3.28,3L21,20.72L19.73,22L16.03,18.33C14.9,18.75 13.68,19 12.39,19C8.36,19 5,15.64 5,11.61C5,10.32 5.25,9.1 5.67,7.97L2,4.27M7,9.39C6.56,10.05 6.26,10.81 6.13,11.61C6.13,15.03 8.97,17.87 12.39,17.87C13.19,17.87 13.95,17.57 14.61,17.13L7,9.39Z"></path></svg>
<h2>Lütfen cihazınızı yatay konuma getirin.</h2>
</div>
<div id="game-wrapper">
<div class="screen active" id="main-menu-screen">
<h1 class="main-title">Arapça Kelime Oyunları</h1>
<div class="main-content-grid">
<div class="selection-wrapper">
<div class="grades-container">
<div class="grade-column grade-9">
<div class="grade-header">1. Seviye</div>
<div class="units-container" id="grade9-container"></div>
</div>
<div class="grade-column grade-10">
<div class="grade-header">2. Seviye</div>
<div class="units-container" id="grade10-container"></div>
</div>
</div>
<div class="actions-column">
<div class="game-selection-panel">
<h3>Oyun Seç</h3>
<div id="game-selector-container"></div>
</div>
</div>
</div>
</div>
</div>
<div class="screen" id="game-screen">
<div class="header-navigation"><button class="back-btn" data-target="main-menu-screen"><svg viewbox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg></button></div>
<div class="score-display" id="player1-display">
<svg viewbox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"></path></svg>
<span id="score1">0</span>
</div>
<div id="game-board"></div>
<div class="score-display" id="player2-display">
<svg viewbox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"></path></svg>
<span id="score2">0</span>
</div>
<div class="game-over-overlay hidden" id="memory-game-over">
<div id="winner-icon-container"></div>
<h2 id="memory-win-text"></h2>
<div class="win-buttons">
<button class="icon-btn" id="play-again-memory-btn" title="Tekrar Oyna"><svg viewbox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path></svg></button>
<button class="icon-btn" id="main-menu-memory-btn" title="Ana Menü"><svg viewbox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg></button>
</div>
</div>
</div>
<div class="screen" id="quiz-screen">
<div class="countdown-overlay" id="quiz-countdown-overlay"></div>
<div class="game-start-overlay" id="quiz-start-overlay">
<button id="quiz-start-btn">BAŞLA</button>
</div>
<div class="header-navigation"><button class="back-btn" data-target="main-menu-screen"><svg viewbox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg></button></div>
<div id="quiz-container">
<div class="quiz-player-area p1">
<div class="score-effects-container"></div>
<div class="quiz-game-content hidden">
<div class="quiz-top-bar">
<div class="quiz-progress" id="quiz-progress-p1"></div>
<div class="progress-bar" id="quiz-progress-bar-p1"></div>
</div>
<div class="quiz-question" id="quiz-question-p1"></div>
<div class="quiz-options" id="quiz-options-p1"></div>
</div>
</div>
<div class="quiz-player-area p2">
<div class="score-effects-container"></div>
<div class="quiz-game-content hidden">
<div class="quiz-top-bar">
<div class="quiz-progress" id="quiz-progress-p2"></div>
<div class="progress-bar" id="quiz-progress-bar-p2"></div>
</div>
<div class="quiz-question" id="quiz-question-p2"></div>
<div class="quiz-options" id="quiz-options-p2"></div>
</div>
</div>
</div>
<div class="game-over-overlay hidden" id="quiz-game-over">
<div id="quiz-winner-icon-container"></div>
<h2 id="quiz-win-text"></h2>
<div class="win-buttons">
<button class="icon-btn" id="new-round-quiz-btn" title="Yeni Tur"><svg viewbox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path></svg></button>
</div>
</div>
</div>
<div class="screen" id="match-screen">
<div class="header-navigation"><button class="back-btn" data-target="main-menu-screen"><svg viewbox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg></button></div>
<div class="match-container">
<div class="match-column" id="match-arabic-list"></div>
<div class="match-column" id="match-turkish-list"></div>
</div>
<div class="game-start-overlay hidden" id="match-complete-overlay">
<button class="icon-btn" id="play-again-match-btn" title="Yeni Oyun">
<svg viewbox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path></svg>
</button>
</div>
</div>
<div class="screen" id="typing-screen">
<div class="header-navigation"><button class="back-btn" data-target="main-menu-screen"><svg viewbox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg></button></div>
<div id="typing-main-container">
<div id="typing-status-panel">
<h2>Durum</h2>
<ul id="typing-status-list"></ul>
</div>
<div id="typing-game-area">
<div class="game-start-overlay hidden" id="typing-game-over">
<button class="icon-btn" id="play-again-typing-btn" title="Tekrar Oyna"><svg viewbox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path></svg></button>
</div>
<div id="typing-interactive-elements">
<div class="typing-stats">
<div class="stat-item" id="timer-stat-item">
<svg viewbox="0 0 24 24"><path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"></path></svg>
<span id="timer-value">120</span>
</div>
<div class="stat-item" id="score-stat-item">
<div class="score-effects-container-typing"></div>
<svg viewbox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
<span id="score-value">0</span>
</div>
</div>
<div class="progress-bar" id="typing-progress-bar"></div>
<div id="typing-prompt"></div>
<div class="typing-input-area">
<input autocomplete="off" id="typing-input" readonly="" spellcheck="false" type="text"/>
<button id="typing-submit-btn"><svg viewbox="0 0 24 24"><path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"></path></svg></button>
</div>
</div>
<div id="virtual-keyboard"></div>
</div>
</div>
<div class="countdown-overlay" id="countdown-overlay"></div>
</div>
<div class="screen results-screen" id="results-screen">
<div class="header-navigation"><button class="back-btn" data-target="main-menu-screen"><svg viewbox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg></button></div>
<h2 id="results-title">Oyun Bitti!</h2><p id="results-score-text"></p>
<div id="results-details"></div>
<div class="win-buttons">
<button class="icon-btn" id="play-again-btn" title="Tekrar Oyna"><svg viewbox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path></svg></button>
<button class="icon-btn" id="new-player-btn" title="Yeni Oyun"><svg viewbox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></button>
<button class="icon-btn" id="main-menu-results-btn" title="Ana Menü"><svg viewbox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg></button>
</div>
</div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {

    // --- DATA MODULE ---
    const Data = {
        grade9: {
            title: "Seviye 1",
            words: {
                unit1: {
                    title: { tr: "1. Ünite" },
                    description: { tr: "Selamlaşma ve Tanışma" },
                    lessons: {
                        lesson1: {
                            description: { tr: "Selamlaşma" },
                            words: [
                                { id: 1, arabic: 'السَّلام عَلَيْكُمْ', turkish: 'Selam üzerinize olsun!' },
                                { id: 2, arabic: 'وَعَلَيْكُم السَّلام', turkish: 'Selam sizin de üzerinize olsun!' },
                                { id: 3, arabic: 'صَباح الخَيْر', turkish: 'Hayırlı Sabahlar' },
                                { id: 4, arabic: 'صَباح النّور', turkish: 'Günaydın' },
                                { id: 5, arabic: 'مَساء الخَيْر', turkish: 'İyi akşamlar' },
                                { id: 6, arabic: 'مَساء النّور', turkish: 'İyi akşamlar (cevap)' },
                                { id: 7, arabic: 'مَرْحَبًا', turkish: 'Merhaba!' },
                                { id: 8, arabic: 'أَهْلًا وَسَهْلًا', turkish: 'Hoş geldiniz!' },
                                { id: 9, arabic: 'أَهْلًا بِك', turkish: 'Hoş bulduk!' },
                                { id: 10, arabic: 'كَيْفَ حالُك؟', turkish: 'Nasılsın?' },
                                { id: 11, arabic: 'أَنا بِخَيْر', turkish: 'İyiyim‫!‬' },
                                { id: 12, arabic: 'إِلى اللِّقاء', turkish: 'Görüşmek üzere!' },
                                { id: 13, arabic: 'مَع السَّلامَة', turkish: 'Hoşça kal' },
                                { id: 14, arabic: 'في أَمان الّٰلهِ', turkish: 'Allah’a emanet ol' },
                                { id: 15, arabic: 'اِقْرَأْ', turkish: 'Oku!' },
                                { id: 16, arabic: 'اُكْتُبْ', turkish: 'Yaz!' },
                                { id: 17, arabic: 'أَعِدْ', turkish: 'Tekrar et!' },
                                { id: 18, arabic: 'اِسْتَمِعْ', turkish: 'Dinle!' }
                            ]
                        },
                        lesson2: {
                            description: { tr: "Tanışma" },
                            words: [
                                { id: 19, arabic: 'طالِب', turkish: 'Erkek öğrenci' },
                                { id: 20, arabic: 'مُدَرِّس', turkish: 'Erkek öğretmen' },
                                { id: 21, arabic: 'صَديق', turkish: 'Erkek arkadaş' },
                                { id: 22, arabic: 'هُوَ', turkish: 'O (erkek)' },
                                { id: 23, arabic: 'هِيَ', turkish: 'O (kadın)' },
                                { id: 24, arabic: 'أَنْتَ', turkish: 'Sen (erkek)' },
                                { id: 25, arabic: 'أَنا', turkish: 'Ben' },
                                { id: 26, arabic: 'ما اسْمُك؟', turkish: 'Adın ne?' },
                                { id: 27, arabic: 'اِسْمي', turkish: 'Benim adım' },
                                { id: 28, arabic: 'مِن أَيْن؟', turkish: 'Nereli?' },
                                { id: 29, arabic: 'نَعَم', turkish: 'Evet' },
                                { id: 30, arabic: 'لا', turkish: 'Hayır' },
                                { id: 31, arabic: 'تَكَلَّمْ', turkish: 'Konuş' },
                                { id: 32, arabic: 'اُسْكُتْ', turkish: 'Sus' },
                                { id: 33, arabic: 'تَعالَ', turkish: 'Gel' },
                                { id: 34, arabic: 'اِذْهَبْ', turkish: 'Git' },
                                { id: 35, arabic: 'تَشَرَّفْتُ', turkish: 'Tanıştığıma memnun oldum' },
                                { id: 36, arabic: 'فُرْصَة سَعيدَة', turkish: 'Memnun oldum' },
                                { id: 37, arabic: 'شُكْرًا', turkish: 'Teşekkür ederim' },
                                { id: 38, arabic: 'عَفْوًا', turkish: 'Rica ederim' }
                            ]
                        }
                    }
                },
                unit2: {
                    title: { tr: "2. Ünite" },
                    description: { tr: "Okulda" },
                    lessons: {
                         lesson1: {
                            description: { tr: "Sınıf Eşyaları" },
                            words: [
                                { id: 101, arabic: 'مَدْرَسَة', turkish: 'Okul' },
                                { id: 102, arabic: 'صَفّ', turkish: 'Sınıf' },
                                { id: 103, arabic: 'كِتاب', turkish: 'Kitap' },
                                { id: 104, arabic: 'دَفْتَر', turkish: 'Defter' },
                                { id: 105, arabic: 'قَلَم', turkish: 'Kalem' },
                                { id: 106, arabic: 'سَبّورة', turkish: 'Tahta' },
                                { id: 107, arabic: 'كُرْسِيّ', turkish: 'Sandalye' },
                                { id: 108, arabic: 'مَكْتَب', turkish: 'Masa' },
                                { id: 109, arabic: 'مِمْحاة', turkish: 'Silgi' },
                                { id: 110, arabic: 'مِسْطَرَة', turkish: 'Cetvel' },
                                { id: 111, arabic: 'حَقيبَة', turkish: 'Çanta' },
                                { id: 112, arabic: 'باب', turkish: 'Kapı' },
                                { id: 113, arabic: 'نافِذَة', turkish: 'Pencere' }
                            ]
                        },
                        lesson2: {
                            description: { tr: "Yönler ve Eylemler" },
                            words: [
                                { id: 114, arabic: 'أَيْن؟', turkish: 'Nerede?' },
                                { id: 115, arabic: 'هُنا', turkish: 'Burada' },
                                { id: 116, arabic: 'هُناك', turkish: 'Orada' },
                                { id: 117, arabic: 'عَلى', turkish: 'Üstünde' },
                                { id: 118, arabic: 'تَحْت', turkish: 'Altında' },
                                { id: 119, arabic: 'أَمام', turkish: 'Önünde' },
                                { id: 120, arabic: 'خَلْف', turkish: 'Arkasında' },
                                { id: 121, arabic: 'فَوْق', turkish: 'Üzerinde' },
                                { id: 122, arabic: 'جَانِب', turkish: 'Yanında' },
                                { id: 123, arabic: 'فِي', turkish: 'İçinde' },
                                { id: 124, arabic: 'خَارِج', turkish: 'Dışında' },
                                { id: 125, arabic: 'اِفْتَح', turkish: 'Kitabı aç' },
                                { id: 126, arabic: 'اِجْلِسْ', turkish: 'Otur' },
                                { id: 127, arabic: 'اُدْخُلِ الصَّفَّ', turkish: 'Sınıfa gir' }
                            ]
                        }
                    }
                },
                unit3: {
                    title: { tr: "3. Ünite" },
                    description: { tr: "Evde" },
                    lessons: {
                        lesson1: {
                            description: { tr: "Evdeyim" },
                            words: [
                                { id: 201, arabic: 'بَيْت', turkish: 'Ev' },
                                { id: 202, arabic: 'غُرْفَة', turkish: 'Oda' },
                                { id: 203, arabic: 'غُرْفَة النَّوْم', turkish: 'Yatak odası' },
                                { id: 204, arabic: 'غُرْفَة جُلوس', turkish: 'Oturma odası' },
                                { id: 205, arabic: 'مَطْبَخ', turkish: 'Mutfak' },
                                { id: 206, arabic: 'حَمّام', turkish: 'Banyo' },
                                { id: 207, arabic: 'سَرير', turkish: 'Yatak' },
                                { id: 208, arabic: 'طاوِلَة', turkish: 'Masa' },
                                { id: 209, arabic: 'كُرْسِيّ', turkish: 'Sandalye' },
                                { id: 210, arabic: 'تِلْفاز', turkish: 'Televizyon' },
                                { id: 211, arabic: 'ثَلّاجة', turkish: 'Buzdolabı' },
                                { id: 212, arabic: 'فُرْن', turkish: 'Fırın' },
                                { id: 213, arabic: 'سَجّادَة', turkish: 'Halı' },
                                { id: 214, arabic: 'هَاتِف', turkish: 'Telefon' },
                                { id: 215, arabic: 'مِصْباح', turkish: 'Lamba' }
                            ]
                        },
                         lesson2: {
                            description: { tr: "Odamda" },
                            words: [
                                { id: 216, arabic: 'غُرْفَتي', turkish: 'Odam' },
                                { id: 217, arabic: 'سَرير', turkish: 'Yatak' },
                                { id: 218, arabic: 'مَكْتَب', turkish: 'Çalışma masası' },
                                { id: 219, arabic: 'كُرْسِيّ', turkish: 'Sandalye' },
                                { id: 220, arabic: 'سِتارَة', turkish: 'Perde' },
                                { id: 221, arabic: 'مِصْباح', turkish: 'Lamba' },
                                { id: 222, arabic: 'مِرْآة', turkish: 'Ayna' },
                                { id: 223, arabic: 'سَجّادَة', turkish: 'Halı' },
                                { id: 224, arabic: 'دُولاب', turkish: 'Dolap' },
                                { id: 225, arabic: 'نَظيف', turkish: 'Temiz' },
                                { id: 226, arabic: 'مُرَتَّب', turkish: 'Düzenli' },
                                { id: 227, arabic: 'وَسِخ', turkish: 'Kirli' },
                                { id: 228, arabic: 'يُنَظِّفُ', turkish: 'Temizliyor' },
                                { id: 229, arabic: 'يُرَتِّبُ', turkish: 'Düzenliyor' }
                            ]
                        }
                    }
                },
                unit4: {
                    title: { tr: "4. Ünite" },
                    description: { tr: "Bir Günüm" },
                    lessons: {
                        lesson1: {
                            description: { tr: "Bir Günüm" },
                            words: [
                                { id: 301, arabic: 'صَباح', turkish: 'Sabah' },
                                { id: 302, arabic: 'ظُهْر', turkish: 'Öğle' },
                                { id: 303, arabic: 'مَساء', turkish: 'Akşam' },
                                { id: 304, arabic: 'لَيْل', turkish: 'Gece' },
                                { id: 305, arabic: 'يَسْتَيْقِظُ', turkish: 'Uyanıyor' },
                                { id: 306, arabic: 'يَغْسِلُ وَجْهَهُ', turkish: 'Yüzünü yıkıyor' },
                                { id: 307, arabic: 'يُصَلّي', turkish: 'Namaz kılıyor' },
                                { id: 308, arabic: 'يَلْبَسُ مَلابِسَهُ', turkish: 'Giyiniyor' },
                                { id: 309, arabic: 'يَتَناوَلُ الفَطور', turkish: 'Kahvaltı yapıyor' },
                                { id: 310, arabic: 'يَذْهَبُ إِلى المَدْرَسَة', turkish: 'Okula gidiyor' },
                                { id: 311, arabic: 'ُيَدْرُس', turkish: 'Ders çalışıyor' },
                                { id: 312, arabic: 'يَرْجِعُ إِلى البَيْت', turkish: 'Eve dönüyor' },
                                { id: 313, arabic: 'يَتَغَدّى', turkish: 'Öğle yemeği yiyor' },
                                { id: 314, arabic: 'يَسْتَريحُ', turkish: 'Dinleniyor' },
                                { id: 315, arabic: 'يَلْعَبُ', turkish: 'Oynuyor' }
                            ]
                        },
                        lesson2: {
                            description: { tr: "Günlük Rutin" },
                            words: [
                                { id: 316, arabic: 'أَسْتَيْقِظُ مُبَكِّرًا', turkish: 'Erken uyanıyorum' },
                                { id: 317, arabic: 'أَذْهَبُ إِلى المَدْرَسَة', turkish: 'Okula gidiyorum' },
                                { id: 318, arabic: 'أُصَلّي صَلاة الظُّهْر', turkish: 'Öğle namazı kılıyorum' },
                                { id: 319, arabic: 'أَتَغَدّى مَع أُسْرَتي', turkish: 'Ailemle öğle yemeği yiyorum' },
                                { id: 320, arabic: 'أَقْرَأُ دُروسي', turkish: 'Derslerimi okuyorum' },
                                { id: 321, arabic: 'أَكْتُبُ واجِباتي', turkish: 'Ödev yazıyorum' },
                                { id: 322, arabic: 'أَلْعَبُ في السّاحَة', turkish: 'Bahçede oynuyorum' },
                                { id: 323, arabic: 'أُساعِدُ أُمّي', turkish: 'Anneme yardım ediyorum' },
                                { id: 324, arabic: 'أَزورُ جَدِي', turkish: 'Dedemi ziyaret ediyorum' },
                                { id: 325, arabic: 'أَذْهَبُ إِلى المَسْجِد', turkish: 'Camiye gidiyorum' },
                                { id: 326, arabic: 'أُرَتِّبُ سَريري', turkish: 'Yatağımı düzeltiyorum' },
                                { id: 327, arabic: 'أُنَظِّفُ غُرْفَتي', turkish: 'Odamı temizliyorum' },
                                { id: 328, arabic: 'أُراجِعُ دُروسي', turkish: 'Derslerimi tekrar ediyorum' },
                                { id: 329, arabic: 'أَنامُ مُتَأَخِّرًا', turkish: 'Geç yatıyorum' }

]
                        }
                    }
                }
            }
        },
        grade10: {
            title: "Seviye 2",
            words: {
                unit1: {
                    title: { tr: "1. Ünite" },
                    description: { tr: "Değerlerim ve Ailem" },
                    lessons: {
                        lesson1: {
                            description: { tr: "Güzel Davranışlar" },
                            words: [
                                { id: 401, arabic: 'صِدْق', turkish: 'Doğruluk' },
                                { id: 402, arabic: 'أَمانَة', turkish: 'Güvenilirlik' },
                                { id: 403, arabic: 'إِخْلاص', turkish: 'Samimiyet' },
                                { id: 404, arabic: 'تَعاوُن', turkish: 'Yardımlaşma' },
                                { id: 405, arabic: 'اِحْتِرام', turkish: 'Saygı' },
                                { id: 406, arabic: 'مَحَبَّة', turkish: 'Sevgi' },
                                { id: 407, arabic: 'شُكْر', turkish: 'Teşekkür' },
                                { id: 408, arabic: 'الِاعْتِذار', turkish: 'Özür dileme' },
                                { id: 409, arabic: 'رَحْمَة', turkish: 'Merhamet' },
                                { id: 410, arabic: 'صَبْر', turkish: 'Sabır' },
                                { id: 411, arabic: 'عَدْل', turkish: 'Adalet' },
                                { id: 412, arabic: 'تَواضُع', turkish: 'Alçakgönüllülük' },
                                { id: 413, arabic: 'يُساعِدُ', turkish: 'Yardım ediyor' },
                                { id: 414, arabic: 'يُحِبُّ', turkish: 'Seviyor' },
                                { id: 415, arabic: 'يَبْتَسِمُ', turkish: 'Gülümsüyor' }
                            ]
                        },
                        lesson2: {
                            description: { tr: "Mutlu Aile" },
                            words: [
                                { id: 416, arabic: 'أُسْرَة', turkish: 'Aile' },
                                { id: 417, arabic: 'أَب', turkish: 'Baba' },
                                { id: 418, arabic: 'أُمّ', turkish: 'Anne' },
                                { id: 419, arabic: 'أَخ', turkish: 'Erkek kardeş' },
                                { id: 420, arabic: 'أُخْت', turkish: 'Kız kardeş' },
                                { id: 421, arabic: 'جَدّ', turkish: 'Dede' },
                                { id: 422, arabic: 'جَدَّة', turkish: 'Nine' },
                                { id: 423, arabic: 'عَمّ', turkish: 'Amca' },
                                { id: 424, arabic: 'عَمَّة', turkish: 'Hala' },
                                { id: 425, arabic: 'خَال', turkish: 'Dayı' },
                                { id: 426, arabic: 'خالَة', turkish: 'Teyze' },
                                { id: 427, arabic: 'أَقارِب', turkish: 'Akrabalar' },
                                { id: 428, arabic: 'يَزورُ الأَقارِب', turkish: 'Akrabaları ziyaret ediyor' },
                                { id: 429, arabic: 'يَحْتَرِمُ الكِبار', turkish: 'Büyüklere saygı gösteriyor' },
                                { id: 430, arabic: 'يَرْحَمُ الصِّغار', turkish: 'Küçüklere merhamet ediyor' }
                            ]
                        }
                    }
                },
                unit2: {
                    title: { tr: "2. Ünite" },
                    description: { tr: "Kendimi Keşfediyorum" },
                    lessons: {
                        lesson1: {
                            description: { tr: "Ben Kimim?" },
                            words: [
                                { id: 501, arabic: 'مَن أَنا؟', turkish: 'Ben kimim?' },
                                { id: 502, arabic: 'اِسْم', turkish: 'İsim' },
                                { id: 503, arabic: 'عُمْر', turkish: 'Yaş' },
                                { id: 504, arabic: 'مِهْنَة', turkish: 'Meslek' },
                                { id: 505, arabic: 'هِوايَة', turkish: 'Hobi' },
                                { id: 506, arabic: 'مَوْهِبَة', turkish: 'Yetenek' },
                                { id: 507, arabic: 'طَيِّب', turkish: 'İyi kalpli' },
                                { id: 508, arabic: 'مُجْتَهِد', turkish: 'Çalışkan' },
                                { id: 509, arabic: 'كَسول', turkish: 'Tembel' },
                                { id: 510, arabic: 'هادِئ', turkish: 'Sakin' },
                                { id: 511, arabic: 'نَشيط', turkish: 'Enerjik' },
                                { id: 512, arabic: 'مُبْتَسِم', turkish: 'Güleryüzlü' },
                                { id: 513, arabic: 'صَبور', turkish: 'Sabırlı' },
                                { id: 514, arabic: 'أَحْلامي', turkish: 'Hayallerim' },
                                { id: 515, arabic: 'مُسْتَقْبَل', turkish: 'Gelecek' }
                            ]
                        },
                        lesson2: {
                            description: { tr: "Hobilerim" },
                            words: [
                                { id: 516, arabic: 'قِراءَة', turkish: 'Okuma' },
                                { id: 517, arabic: 'كِتابَة', turkish: 'Yazma' },
                                { id: 518, arabic: 'رَسْم', turkish: 'Resim yapma' },
                                { id: 519, arabic: 'طَبْخ', turkish: 'Yemek pişirme' },
                                { id: 520, arabic: 'تَصْوير', turkish: 'Fotoğrafçılık' },
                                { id: 521, arabic: 'رِياضَة', turkish: 'Spor' },
                                { id: 522, arabic: 'كُرَة القَدَم', turkish: 'Futbol' },
                                { id: 523, arabic: 'كُرَة السَّلَّة', turkish: 'Basketbol' },
                                { id: 524, arabic: 'سَفَر', turkish: 'Seyahat' },
                                { id: 525, arabic: 'طَبيعَة', turkish: 'Doğa' },
                                { id: 526, arabic: 'أَفْلام', turkish: 'Filmler' },
                                { id: 527, arabic: 'موسيقى', turkish: 'Müzik' },
                                { id: 528, arabic: 'مَكْتَبَة', turkish: 'Kütüphane' },
                                { id: 529, arabic: 'في الوَقْت الفارِغ', turkish: 'Boş zamanlarda' },
                                { id: 530, arabic: 'مُفيد', turkish: 'Faydalı' },
                                { id: 531, arabic: 'مُمْتِع', turkish: 'Eğlenceli' }
                            ]
                        }
                    }
                },
                unit3: {
                    title: { tr: "3. Ünite" },
                    description: { tr: "Zaman ve Hayat" },
                    lessons: {
                        lesson1: {
                            description: { tr: "Zamanım ve Hayatım" },
                            words: [
                                { id: 601, arabic: 'وَقْتي', turkish: 'Zamanım' },
                                { id: 602, arabic: 'حَياتي', turkish: 'Hayatım' },
                                { id: 603, arabic: 'نَوْم', turkish: 'Uyku' },
                                { id: 604, arabic: 'عَمَل', turkish: 'Çalışma' },
                                { id: 605, arabic: 'اِسْتِراحَة', turkish: 'Dinlenme' },
                                { id: 606, arabic: 'نَهار', turkish: 'Gündüz' },
                                { id: 607, arabic: 'يُنَظِّمُ', turkish: 'Düzenliyor' },
                                { id: 608, arabic: 'يُخَطِّطُ', turkish: 'Planlıyor' },
                                { id: 609, arabic: 'يَدْرُسُ', turkish: 'Ders çalışıyor' },
                                { id: 610, arabic: 'يَسْتَريحُ', turkish: 'Dinleniyor' },
                                { id: 611, arabic: 'كُلّ يَوْم', turkish: 'Her gün' },
                                { id: 612, arabic: 'أَحْيانًا', turkish: 'Bazen' },
                                { id: 613, arabic: 'نادِرًا', turkish: 'Nadiren' },
                                { id: 614, arabic: 'دائِمًا', turkish: 'Her zaman' },
                                { id: 615, arabic: 'نَجاح', turkish: 'Başarı' }
                            ]
                        },
                        lesson2: {
                            description: { tr: "Zamanımı Değerlendiriyorum" },
                            words: [
                                { id: 616, arabic: 'تَّخْطيط', turkish: 'Planlama' },
                                { id: 617, arabic: 'فَشَل', turkish: 'Başarısızlık' },
                                { id: 618, arabic: 'جِدّ', turkish: 'Ciddiyet' },
                                { id: 619, arabic: 'كَسَل', turkish: 'Tembellik' },
                                { id: 620, arabic: 'حِكْمَة', turkish: 'Bilgelik' },
                                { id: 621, arabic: 'إِبْداع', turkish: 'Yaratıcılık' },
                                { id: 622, arabic: 'لا يُؤَجِّلُ', turkish: 'Ertelemiyor' },
                                { id: 623, arabic: 'يَسْتَغِلُّ الوَقْت', turkish: 'Zamanı değerlendiriyor' },
                                { id: 624, arabic: 'يُضَيِّعُ الوَقْت', turkish: 'Zamanı boşa harcıyor' },
                                { id: 625, arabic: 'يَوْم', turkish: 'Gün' },
                                { id: 626, arabic: 'أُسْبوع', turkish: 'Hafta' },
                                { id: 627, arabic: 'مُسْتَقْبَل', turkish: 'Gelecek' },
                                { id: 628, arabic: 'حاضِر', turkish: 'Şimdi' },
                                { id: 629, arabic: 'مَاضي', turkish: 'Geçmiş' },
                                { id: 630, arabic: 'تَطْوير النَّفْس', turkish: 'Kendini geliştirme' }
                            ]
                        }
                    }
                },
                 unit4: {
                    title: { tr: "4. Ünite" },
                    description: { tr: "Sağlık ve Beslenme" },
                    lessons: {
                        lesson1: {
                            description: { tr: "Sağlıklı Yaşam" },
                            words: [
                                { id: 701, arabic: 'جِسْم', turkish: 'Vücut' },
                                { id: 702, arabic: 'عَقْل', turkish: 'Akıl' },
                                { id: 703, arabic: 'نَظّافَة', turkish: 'Temizlik' },
                                { id: 704, arabic: 'غِذاء', turkish: 'Beslenme' },
                                { id: 705, arabic: 'صِحَّة', turkish: 'Sağlık' },
                                { id: 706, arabic: 'مَرَض', turkish: 'Hastalık' },
                                { id: 707, arabic: 'طَبيب', turkish: 'Doktor' },
                                { id: 708, arabic: 'دَواء', turkish: 'İlaç' },
                                { id: 709, arabic: 'أَسْنان', turkish: 'Dişler' },
                                { id: 710, arabic: 'النَّظّافَة مِن الإِيمان', turkish: 'Temizlik imandandır' },
                                { id: 711, arabic: 'يُفَرِّشُ الأَسْنان', turkish: 'Diş fırçalıyor' },
                                { id: 712, arabic: 'يَسْتَحِمُّ', turkish: 'Banyo yapıyor' },
                                { id: 713, arabic: 'يَنامُ مُبَكِّرًا', turkish: 'Erken uyuyor' },
                                { id: 714, arabic: 'صِحِّيّ', turkish: 'Sağlıklı' },
                                { id: 715, arabic: 'يُمارِسُ الرِّياضَة', turkish: 'Spor yapıyor' }
                            ]
                        },
                        lesson2: {
                            description: { tr: "Sağlıklı Beslenme" },
                            words: [
                                { id: 716, arabic: 'فَواكِه', turkish: 'Meyveler' },
                                { id: 717, arabic: 'خُضْراوات', turkish: 'Sebzeler' },
                                { id: 718, arabic: 'لَحْم', turkish: 'Et' },
                                { id: 719, arabic: 'سَمَك', turkish: 'Balık' },
                                { id: 720, arabic: 'لَبَن', turkish: 'Süt' },
                                { id: 721, arabic: 'جُبْن', turkish: 'Peynir' },
                                { id: 222, arabic: 'بَيْض', turkish: 'Yumurta' },
                                { id: 723, arabic: 'خُبْز', turkish: 'Ekmek' },
                                { id: 724, arabic: 'ماء', turkish: 'Su' },
                                { id: 725, arabic: 'عَصير', turkish: 'Meyve suyu' },
                                { id: 726, arabic: 'الطَّعام السَّريع', turkish: 'Fast food' },
                                { id: 727, arabic: 'المَشْروبات الغازِيَة', turkish: 'Gazlı içecekler' },
                                { id: 728, arabic: 'فَطور', turkish: 'Kahvaltı' },
                                { id: 729, arabic: 'غَداء', turkish: 'Öğle yemeği' },
                                { id: 730, arabic: 'عَشاء', turkish: 'Akşam yemeği' }
                            ]
                        }
                    }
                }
            }
        }
    };
// === DERS SEÇİLMEDEN OYUNLAR KİLİTLİ ===
(function () {
  // Güvenli kilitle/aç yardımcıları
  function lockGames() {
    document.querySelectorAll('.menu-btn').forEach(b => {
      b.classList.add('locked');
      b.classList.remove('unlocked');
    });
  }
  function unlockGames() {
    document.querySelectorAll('.menu-btn').forEach(b => {
      b.classList.remove('locked');
      b.classList.add('unlocked');
    });
  }

  // Oyun kartları dinamik üretildiği için, hazır olana kadar bekle
  function waitForMenuButtons(tries = 0) {
    const buttons = document.querySelectorAll('.menu-btn');
    if (buttons.length) {
      lockGames();
    } else if (tries < 80) { // ~4sn
      setTimeout(() => waitForMenuButtons(tries + 1), 50);
    }
  }
  waitForMenuButtons();

  // Herhangi bir ders seçilince oyunları aç
  document.addEventListener('click', (e) => {
    const lessonBtn = e.target.closest('.lesson-btn');
    if (lessonBtn) {
      // istersen önce "seçili" durumu da ver:
      document.querySelectorAll('.lesson-btn').forEach(b => b.classList.remove('selected'));
      lessonBtn.classList.add('selected');

      unlockGames();
    }
  });
})();


    // --- UTILS MODULE ---
    const Utils = {
        shuffleArray: (arr) => [...arr].sort(() => 0.5 - Math.random()),
        stripHarakat: (text) => text.replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E8\u06EA-\u06ED]/g, '').replace(/[؟?]/g, ''),
        normalizeForTyping: (text) => text.replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E8\u06EA-\u06ED]/g, '').replace(/[أإآ]/g, 'ا').replace(/ى/g, 'ي').replace(/[؟?]/g, '')
    };

    // --- APP MODULE ---
    const App = {
        state: {
            currentGrade: null,
            currentUnitKey: null,
            currentLessonKey: null,
            currentActiveGame: null,
            activeGameModule: null,
            isAudioInitialized: false,
            audioCtx: null,
        },
        dom: {
            screens: document.querySelectorAll('.screen'),
        },
        init() {
            this.populateMainMenu();
            this.initNavigation();
            MemoryGame.init();
            QuizGame.init();
            MatchGame.init();
            TypingGame.init();
            this.updateHighlights();
        },
        showScreen(screenId) {
            this.dom.screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            if (screenId === 'main-menu-screen') {
                this.restoreMenuState();
                this.updateHighlights();
            }
        },
        initAudio() {
            if (this.state.audioCtx && this.state.audioCtx.state === 'running') return;
            try {
                if (!this.state.audioCtx) {
                    this.state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.state.audioCtx.state === 'suspended') {
                    this.state.audioCtx.resume().then(() => {
                        this.state.isAudioInitialized = true;
                    });
                } else {
                    this.state.isAudioInitialized = true;
                }
            } catch (e) {
                console.error("Web Audio API bu tarayıcıda desteklenmiyor.");
                this.state.isAudioInitialized = false;
            }
        },
        playSound(soundKey) {
            if (!this.state.isAudioInitialized || !this.state.audioCtx || this.state.audioCtx.state !== 'running') return;
            const sounds = {
                flip: { f: 200, t: 'triangle', d: 0.1 },
                match: { f: 440, t: 'sine', d: 0.2 },
                menuClick: { f: 600, t: 'square', d: 0.08 },
                touch: { f: 300, t: 'sine', d: 0.05 },
                correct: { f: 523.25, t: 'sine', d: 0.2 },
                incorrect: { f: 164.81, t: 'square', d: 0.2 },
                countdown: { f: 880, t: 'sine', d: 0.15 }
            };
            const sound = sounds[soundKey];
            if (!sound) return;

            const g = this.state.audioCtx.createGain();
            g.connect(this.state.audioCtx.destination);
            g.gain.setValueAtTime(0, this.state.audioCtx.currentTime);
            g.gain.linearRampToValueAtTime(0.1, this.state.audioCtx.currentTime + 0.01);
            g.gain.linearRampToValueAtTime(0, this.state.audioCtx.currentTime + sound.d);

            const o = this.state.audioCtx.createOscillator();
            o.type = sound.t;
            o.frequency.value = sound.f;
            o.connect(g);
            o.start(0);
            o.stop(this.state.audioCtx.currentTime + sound.d);
        },
        getWords(combine = false) {
            const gradeData = Data[this.state.currentGrade]?.words;
            if (!gradeData) return [];

            if (this.state.currentUnitKey === 'all') {
                return Object.values(gradeData)
                    .flatMap(unit => Object.values(unit.lessons))
                    .flatMap(lesson => lesson.words || []);
            }

            const lessons = gradeData[this.state.currentUnitKey]?.lessons;
            if (!lessons) return [];

            if (combine) {
                return Object.values(lessons).flatMap(lesson => lesson.words || []);
            }
            return lessons[this.state.currentLessonKey]?.words || [];
        },
        initNavigation() {
            document.querySelectorAll('.back-btn').forEach(button => {
                button.onclick = (e) => {
                    this.playSound('menuClick');
                    if (this.state.activeGameModule && typeof this.state.activeGameModule.stop === 'function') {
                        this.state.activeGameModule.stop();
                    }
                    this.showScreen('main-menu-screen');
                };
            });

            document.getElementById('start-game-btn').onclick = () => {
                this.playSound('menuClick');
                const { currentGrade, currentUnitKey, currentLessonKey, currentActiveGame } = this.state;
                if (!currentGrade || !currentUnitKey || !currentLessonKey || !currentActiveGame) return;

                const gameModules = { memory: MemoryGame, quiz: QuizGame, match: MatchGame, typing: TypingGame };
                this.state.activeGameModule = gameModules[currentActiveGame];

                if (this.state.activeGameModule) {
                    this.showScreen(this.state.activeGameModule.screenId);
                    this.state.activeGameModule.start();
                }
            };
        },
        populateMainMenu() {
            const grade9Container = document.getElementById('grade9-container');
            const grade10Container = document.getElementById('grade10-container');
            const gameContainer = document.getElementById('game-selector-container');

            grade9Container.innerHTML = '';
            grade10Container.innerHTML = '';
            gameContainer.innerHTML = '';

            const createUnitPanel = (gradeKey, unitKey, unit) => {
                const details = document.createElement('details'); // <details> etiketi oluştur
                details.className = `unit-panel unit-${unitKey.replace('unit', '')}`; // CSS renklendirmesi için sınıf ekle

                const summary = document.createElement('summary'); // <summary> etiketi oluştur
                summary.textContent = `${unit.title.tr} - ${unit.description.tr}`;
                details.appendChild(summary); // summary'yi details içine ekle

                const lessonsContainer = document.createElement('div');
                lessonsContainer.className = 'lessons-container';
                Object.keys(unit.lessons).forEach((lessonKey, index) => {
                    const lesson = unit.lessons[lessonKey];
                    const btn = document.createElement('button');
                    btn.className = 'lesson-btn';
                    btn.textContent = `${index + 1}. Ders: ${lesson.description.tr}`;
                    btn.dataset.grade = gradeKey;
                    btn.dataset.unit = unitKey;
                    btn.dataset.lesson = lessonKey;
                    lessonsContainer.appendChild(btn);
                });
                details.appendChild(lessonsContainer); // lessonsContainer'ı details içine ekle
                return details; // details elementini döndür
            };


            for (const key in Data.grade9.words) {
                grade9Container.appendChild(createUnitPanel('grade9', key, Data.grade9.words[key]));
            }
            for (const key in Data.grade10.words) {
                grade10Container.appendChild(createUnitPanel('grade10', key, Data.grade10.words[key]));
            }

            const gameTypes = [
                { type: 'memory', title: 'Hafıza Kartı', svg: '<svg viewBox="0 0 24 24"><path d="M7 3H17C18.1 3 19 3.9 19 5V15C19 16.1 18.1 17 17 17H7C5.9 17 5 16.1 5 15V5C5 3.9 5.9 3 7 3M3 7V19C3 20.1 3.9 21 5 21H15V19H5V7H3Z" /></svg>' },
                { type: 'quiz', title: 'İkili Test', svg: '<svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6M11,16H13V18H11V16Z" /></svg>' },
                { type: 'match', title: 'Eşleştirme', svg: '<svg viewBox="0 0 24 24"><path d="M21,9L17,5V8H10V10H17V13M7,11V8L3,12L7,16V13H14V11H7Z" /></svg>' },
                { type: 'typing', title: 'Klavye Oyunu', svg: '<svg viewBox="0 0 24 24"><path d="M20 5H4C2.9 5 2 5.9 2 7V17C2 18.1 2.9 19 4 19H20C21.1 19 22 18.1 22 17V7C22 5.9 21.1 5 20 5M20 17H4V7H20V17M15 8H17V10H15V8M15 11H17V13H15V11M12 8H14V10H12V8M12 11H14V13H12V11M9 8H11V10H9V8M9 11H11V13H9V11M6 8H8V10H6V8M6 11H8V13H6V11M7 14H17V16H7V14Z" /></svg>' }
            ];

            gameTypes.forEach(game => {
                const btn = document.createElement('button');
                btn.className = 'menu-btn';
                btn.dataset.game = game.type;
                btn.innerHTML = `${game.svg}<div><span class="menu-title">${game.title}</span></div>`;
                gameContainer.appendChild(btn);
            });

            const startBtn = document.getElementById('start-game-btn');
            if (startBtn) {
                gameContainer.appendChild(startBtn);
                startBtn.textContent = 'Oyuna Başla';
            }

            document.getElementById('main-menu-screen').addEventListener('click', e => {
                this.initAudio();
                const lessonBtn = e.target.closest('.lesson-btn');
                const gameBtn = e.target.closest('#game-selector-container .menu-btn');
                const summaryEl = e.target.closest('summary'); // Summary tıklamasını yakala

                if (summaryEl) {
                    this.playSound('menuClick'); // Ünite açma/kapama sesi
                    // Aynı anda sadece bir ünitenin açık kalmasını sağla (opsiyonel)
                    const parentDetails = summaryEl.parentElement;
                    if (parentDetails.tagName === 'DETAILS') {
                         document.querySelectorAll('.unit-panel[open]').forEach(openDetail => {
                            if (openDetail !== parentDetails) {
                                openDetail.removeAttribute('open');
                            }
                        });
                    }
                } else if (lessonBtn) {
                    this.playSound('menuClick');
                    if (lessonBtn.classList.contains('selected')) {
                        lessonBtn.classList.remove('selected');
                        this.state.currentGrade = null;
                        this.state.currentUnitKey = null;
                        this.state.currentLessonKey = null;
                        this.state.currentActiveGame = null;
                        document.querySelectorAll('#game-selector-container .menu-btn').forEach(b => b.classList.remove('selected'));
                    } else {
                        document.querySelectorAll('.lesson-btn').forEach(b => b.classList.remove('selected'));
                        lessonBtn.classList.add('selected');
                        this.state.currentGrade = lessonBtn.dataset.grade;
                        this.state.currentUnitKey = lessonBtn.dataset.unit;
                        this.state.currentLessonKey = lessonBtn.dataset.lesson;
                    }
                    this.updateHighlights();
                } else if (gameBtn && gameBtn.dataset.game) {
                    this.playSound('menuClick');
                    document.querySelectorAll('#game-selector-container .menu-btn').forEach(b => b.classList.remove('selected'));
                    gameBtn.classList.add('selected');
                    this.state.currentActiveGame = gameBtn.dataset.game;
                    this.updateHighlights();
                }
                this.checkStartButtonState();
            });
        },
        checkStartButtonState() {
            const startBtn = document.getElementById('start-game-btn');
            if (this.state.currentLessonKey && this.state.currentActiveGame) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        },
        restoreMenuState() {
            if(this.state.currentLessonKey) {
                const selector = `.lesson-btn[data-grade='${this.state.currentGrade}'][data-unit='${this.state.currentUnitKey}'][data-lesson='${this.state.currentLessonKey}']`;
                const selectedLessonBtn = document.querySelector(selector);
                if(selectedLessonBtn) {
                     selectedLessonBtn.classList.add('selected');
                     // Üstündeki details elementini aç
                     const parentDetails = selectedLessonBtn.closest('details');
                     if(parentDetails) parentDetails.setAttribute('open', '');
                }
            }
            if(this.state.currentActiveGame) {
                const selectedGameBtn = document.querySelector(`.menu-btn[data-game='${this.state.currentActiveGame}']`);
                if(selectedGameBtn) selectedGameBtn.classList.add('selected');
            }
            this.checkStartButtonState();
        },
        updateHighlights() {
            const gradesContainer = document.querySelector('.grades-container');
            const gamePanel = document.querySelector('.game-selection-panel');

            gradesContainer.classList.remove('highlight');
            gamePanel.classList.remove('highlight');

            const lessonSelected = this.state.currentLessonKey;
            const gameSelected = this.state.currentActiveGame;

            if (lessonSelected && !gameSelected) {
                gamePanel.classList.add('highlight');
            }
        },
        showResults(gameType, score, details) {
            const resultsScreen = document.getElementById('results-screen');
            const resultsNav = resultsScreen.querySelector('.header-navigation');
            const resultsDetailsContainer = document.getElementById('results-details');
            resultsDetailsContainer.innerHTML = '';
            resultsDetailsContainer.classList.remove('hidden');
            let message = '';

            const playAgainBtn = document.getElementById('play-again-btn');
            const newPlayerBtn = document.getElementById('new-player-btn');
            const mainMenuBtn = document.getElementById('main-menu-results-btn');
            const resultsTitle = document.getElementById('results-title');

            resultsScreen.classList.remove('match-complete');
            resultsNav.classList.remove('hidden');
            playAgainBtn.classList.remove('hidden');
            newPlayerBtn.classList.remove('hidden');
            mainMenuBtn.classList.remove('hidden');
            resultsTitle.textContent = 'Oyun Bitti!';

            newPlayerBtn.title = "Yeni Oyun";
            newPlayerBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>`;
            const svgEl = newPlayerBtn.querySelector('svg');
            if (svgEl) {
                svgEl.style.width = '';
                svgEl.style.height = '';
                svgEl.style.animation = '';
            }

            if (gameType === 'match') {
                resultsScreen.classList.add('match-complete');
                resultsNav.classList.add('hidden');
                message = '';
                playAgainBtn.classList.add('hidden');
                mainMenuBtn.classList.add('hidden');
                resultsDetailsContainer.classList.add('hidden');
                resultsTitle.textContent = "";

                newPlayerBtn.title = "Yeni Oyun";
                const newIconSVG = `<svg viewBox="0 0 24 24"><path d="M12,6V9L16,5L12,1V4C7.58,4 4,7.58 4,12C4,13.57 4.46,15.03 5.24,16.26L6.7,14.8C6.25,13.97 6,13.01 6,12C6,8.69 8.69,6 12,6M18.76,7.74L17.3,9.2C17.74,10.04 18,10.99 18,12C18,15.31 15.31,18 12,18V15L8,19L12,23V20C16.42,20 20,16.42 20,12C20,10.43 19.54,8.97 18.76,7.74Z"/></svg>`;
                newPlayerBtn.innerHTML = newIconSVG;
                const newSvgEl = newPlayerBtn.querySelector('svg');
                if (newSvgEl) {
                    newSvgEl.style.width = '100px';
                    newSvgEl.style.height = '100px';
                    newSvgEl.style.animation = 'pulse-glow 1.5s infinite ease-in-out';
                }
            } else if (gameType === 'quiz') {
                message = `${details} sorudan ${score} doğru!`;
            } else if (gameType === 'typing') {
                message = `Süre doldu! Final skorun: ${score}`;
                if (details && details.length > 0) {
                    let listHTML = '<h3>Yanlış yazdığın kelimeler:</h3><ul>';
                    details.forEach(item => {
                        listHTML += `<li><span class="prompt">${item.prompt}:</span> <span class="user-answer">${item.incorrect}</span> ➜ <span class="correct-answer">${item.correct}</span></li>`;
                    });
                    listHTML += '</ul>';
                    resultsDetailsContainer.innerHTML = listHTML;
                }
            }
            document.getElementById('results-score-text').textContent = message;
            this.showScreen('results-screen');
        }
    };

    // --- MEMORY GAME MODULE ---
    const MemoryGame = {
        screenId: 'game-screen',
        state: {},
        dom: {},
        init() {
            this.dom.board = document.getElementById('game-board');
            this.dom.p1Display = document.getElementById('player1-display');
            this.dom.p2Display = document.getElementById('player2-display');
            this.dom.score1 = document.getElementById('score1');
            this.dom.score2 = document.getElementById('score2');
            this.dom.gameOverContainer = document.getElementById('memory-game-over');
            this.dom.winText = document.getElementById('memory-win-text');
            this.dom.winnerIcon = document.getElementById('winner-icon-container');

            document.getElementById('play-again-memory-btn').onclick = () => { App.playSound('menuClick'); this.start(); };
            document.getElementById('main-menu-memory-btn').onclick = () => {
                App.playSound('menuClick');
                App.showScreen('main-menu-screen');
            };
        },
        start() {
            this.state = { f: [], p: 0, l: false, c: 1, s1: 0, s2: 0, w: [], flipTimeout: null };
            this.dom.score1.textContent = '0';
            this.dom.score2.textContent = '0';
            this.dom.gameOverContainer.classList.add('hidden');
            this.updateTurnIndicator();

            let wordsForGame = App.getWords();
            this.state.w = Utils.shuffleArray(wordsForGame).slice(0, 10);

            const pairs = this.state.w.flatMap(w => [{ content: w.arabic, id: w.id, lang: 'ar' }, { content: w.turkish, id: w.id, lang: 'tr' }]);
            this.populateBoard(Utils.shuffleArray(pairs));
        },
        stop() {
            if (this.state.flipTimeout) clearTimeout(this.state.flipTimeout);
        },
        populateBoard(cards) {
            this.dom.board.innerHTML = '';
            cards.forEach(cardData => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.dataset.id = cardData.id;
                const formattedContent = cardData.content;
                cardEl.innerHTML = `<div class="card-inner"><div class="card-face card-front"></div><div class="card-face card-back" dir="${cardData.lang === 'tr' ? 'ltr' : 'rtl'}">${formattedContent}</div></div>`;
                cardEl.onclick = () => this.flipCard(cardEl);
                this.dom.board.appendChild(cardEl);
            });
        },
        flipCard(card) {
            if (this.state.l || card.classList.contains('flipped') || card.classList.contains('matched')) return;

            App.playSound('flip');
            card.classList.add('flipped');
            card.classList.add(this.state.c === 1 ? 'p1-turn' : 'p2-turn');
            this.state.f.push(card);

            if (this.state.f.length === 2) {
                this.state.l = true;
                const [c1, c2] = this.state.f;

                if (c1.dataset.id === c2.dataset.id) {
                    App.playSound('match');
                    const matchClass = this.state.c === 1 ? 'p1-match' : 'p2-match';
                    if (this.state.c === 1) this.dom.score1.textContent = ++this.state.s1;
                    else this.dom.score2.textContent = ++this.state.s2;

                    this.state.f.forEach(c => {
                        c.classList.remove('p1-turn', 'p2-turn');
                        c.classList.add('matched', matchClass);
                    });

                    this.state.p++;
                    this.state.f = [];
                    this.state.l = false;

                    if (this.state.p === this.state.w.length) {
                        setTimeout(() => this.showEndUI(), 700);
                    }
                } else {
                    this.state.flipTimeout = setTimeout(() => {
                        this.state.f.forEach(c => {
                            c.classList.remove('flipped', 'p1-turn', 'p2-turn');
                        });
                        this.state.f = [];
                        this.state.c = this.state.c === 1 ? 2 : 1;
                        this.updateTurnIndicator();
                        this.state.l = false;
                    }, 1200);
                }
            }
        },
        updateTurnIndicator() {
            this.dom.p1Display.classList.toggle('active', this.state.c === 1);
            this.dom.p2Display.classList.toggle('active', this.state.c !== 1);
        },
        showEndUI() {
            let text;
            let winner = 0;
            if (this.state.s1 > this.state.s2) { text = '1. Oyuncu Kazandı!'; winner = 1; }
            else if (this.state.s2 > this.state.s1) { text = '2. Oyuncu Kazandı!'; winner = 2; }
            else { text = 'Berabere!'; }

            this.dom.winText.innerText = text;

            this.dom.winText.className = '';
            this.dom.winnerIcon.className = '';
            this.dom.winnerIcon.innerHTML = '';

            let winnerClass = '';
            const iconSVG = `<svg viewBox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg>`;

            if (winner === 1) winnerClass = 'p1-win';
            else if (winner === 2) winnerClass = 'p2-win';
            else winnerClass = 'draw';

            this.dom.winText.classList.add(winnerClass);
            this.dom.winnerIcon.classList.add('winner-icon', winnerClass);

            if(winner > 0) {
                this.dom.winnerIcon.innerHTML = iconSVG;
            } else {
                this.dom.winnerIcon.innerHTML = iconSVG + iconSVG;
            }

            this.dom.gameOverContainer.classList.remove('hidden');
        }
    };

    // --- QUIZ GAME MODULE ---
    const QuizGame = {
        screenId: 'quiz-screen',
        state: {},
        dom: {},
        init() {
            this.dom.p1 = {
                area: document.querySelector('.quiz-player-area.p1'),
                progress: document.getElementById('quiz-progress-p1'),
                progressBar: document.getElementById('quiz-progress-bar-p1'),
                question: document.getElementById('quiz-question-p1'),
                options: document.getElementById('quiz-options-p1'),
                content: document.querySelector('.quiz-player-area.p1 .quiz-game-content'),
                effectsContainer: document.querySelector('.quiz-player-area.p1 .score-effects-container'),
            };
            this.dom.p2 = {
                area: document.querySelector('.quiz-player-area.p2'),
                progress: document.getElementById('quiz-progress-p2'),
                progressBar: document.getElementById('quiz-progress-bar-p2'),
                question: document.getElementById('quiz-question-p2'),
                options: document.getElementById('quiz-options-p2'),
                content: document.querySelector('.quiz-player-area.p2 .quiz-game-content'),
                effectsContainer: document.querySelector('.quiz-player-area.p2 .score-effects-container'),
            };
            this.dom.startBtn = document.getElementById('quiz-start-btn');
            this.dom.startOverlay = document.getElementById('quiz-start-overlay');
            this.dom.gameOverContainer = document.getElementById('quiz-game-over');
            this.dom.winText = document.getElementById('quiz-win-text');
            this.dom.winnerIcon = document.getElementById('quiz-winner-icon-container');
            this.dom.countdownOverlay = document.getElementById('quiz-countdown-overlay');

            this.dom.startBtn.onclick = () => {
                App.initAudio();
                App.playSound('menuClick');
                this.dom.startOverlay.style.display = 'none';
                this.startCountdown();
            };
            document.getElementById('new-round-quiz-btn').onclick = () => { App.playSound('menuClick'); this.start(true); };
        },
        start(isReplay = false) {
            const questionsPool = Utils.shuffleArray(App.getWords(true)).slice(0, 5);

            const p1Questions = [...questionsPool];
            let p2Questions = Utils.shuffleArray([...questionsPool]);

            let needsReshuffle = true;
            while(needsReshuffle) {
                needsReshuffle = false;
                for (let i = 0; i < p1Questions.length; i++) {
                    if (p1Questions[i].id === p2Questions[i].id) {
                        needsReshuffle = true;
                        p2Questions = Utils.shuffleArray([...questionsPool]);
                        break;
                    }
                }
            }

            this.state = {
                p1Questions: p1Questions,
                p2Questions: p2Questions,
                p1Index: 0, p2Index: 0, p1Score: 0, p2Score: 0,
                p1Finished: false, p2Finished: false,
                p1StartTime: null, p2StartTime: null,
                p1Timeout: null, p2Timeout: null,
                questionsPerRound: questionsPool.length,
                answerLog: {}
            };

            this.dom.gameOverContainer.classList.add('hidden');
            this.createProgressBar(1);
            this.createProgressBar(2);

            if (isReplay) {
                [this.dom.p1, this.dom.p2].forEach(p => {
                     p.content.classList.add('hidden');
                });
                this.dom.startOverlay.style.display = 'flex';
                this.dom.startBtn.classList.remove('hidden');
            } else {
                this.dom.startOverlay.style.display = 'flex';
                this.dom.startBtn.classList.add('hidden');
                 [this.dom.p1, this.dom.p2].forEach(p => {
                    p.content.classList.remove('hidden');
                    p.progress.innerHTML = '';
                    p.question.innerHTML = '...';
                    p.options.innerHTML = Array(5).fill('').map(() => `<button class="quiz-option-btn" disabled>...</button>`).join('');
                });

                this.dom.startBtn.classList.remove('hidden');
            }
        },
        stop() {
            if (this.state.p1Timeout) clearTimeout(this.state.p1Timeout);
            if (this.state.p2Timeout) clearTimeout(this.state.p2Timeout);
        },
        startCountdown() {
            this.dom.countdownOverlay.style.display = 'flex';
            let count = 3;
            this.dom.countdownOverlay.textContent = count;
            App.playSound('countdown');

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    this.dom.countdownOverlay.textContent = count;
                    App.playSound('countdown');
                } else {
                    clearInterval(countdownInterval);
                    this.dom.countdownOverlay.style.display = 'none';
                    this.startGameLoop();
                }
            }, 1000);
        },
        startGameLoop() {
            this.dom.p1.content.classList.remove('hidden');
            this.dom.p2.content.classList.remove('hidden');
            this.showQuestion(1);
            this.showQuestion(2);
        },
        createProgressBar(playerNum) {
            const playerDom = (playerNum === 1) ? this.dom.p1 : this.dom.p2;
            playerDom.progressBar.innerHTML = '';
            for (let i = 0; i < this.state.questionsPerRound; i++) {
                const segment = document.createElement('div');
                segment.className = 'progress-segment';
                playerDom.progressBar.appendChild(segment);
            }
        },
        showQuestion(playerNum) {
            const playerState = (playerNum === 1) ? { q: this.state.p1Questions, i: this.state.p1Index, s: this.state.p1Score } : { q: this.state.p2Questions, i: this.state.p2Index, s: this.state.p2Score };
            const playerDom = (playerNum === 1) ? this.dom.p1 : this.dom.p2;

            if (playerState.i >= playerState.q.length) {
                if (playerNum === 1) this.state.p1Finished = true; else this.state.p2Finished = true;
                playerDom.question.textContent = 'Bitti!';
                playerDom.options.innerHTML = '';
                const scoreIcon = `<svg viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg>`;
                playerDom.progress.innerHTML = `<div class="quiz-score-display">${scoreIcon}<span>${playerState.s}</span></div>`;

                if (this.state.p1Finished && this.state.p2Finished) this.endGame();
                return;
            }

            const word = playerState.q[playerState.i];

            playerDom.options.classList.remove('answered');

            const scoreIcon = `<svg viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg>`;
            playerDom.progress.innerHTML = `
                <div class="quiz-score-display">${scoreIcon}<span>${playerState.s}</span></div>
            `;

            const segments = playerDom.progressBar.children;
            Array.from(segments).forEach(seg => seg.classList.remove('active'));
            if(segments[playerState.i]) segments[playerState.i].classList.add('active');


            playerDom.question.textContent = word.arabic;

            const allAnswers = App.getWords(true).map(w => w.turkish);
            const wrongAnswers = Utils.shuffleArray(allAnswers.filter(t => t !== word.turkish)).slice(0, 4);
            const options = Utils.shuffleArray([word.turkish, ...wrongAnswers]);

            playerDom.options.innerHTML = '';

            options.forEach((text) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option-btn';
                btn.textContent = text;
                btn.onclick = (e) => this.checkAnswer(e.currentTarget, word.turkish, playerNum);
                playerDom.options.appendChild(btn);
            });

            if(playerNum === 1) this.state.p1StartTime = Date.now();
            else this.state.p2StartTime = Date.now();
        },
        checkAnswer(button, correctAnswer, playerNum) {
            App.playSound('touch');
            const timeTaken = (playerNum === 1) ? (Date.now() - this.state.p1StartTime) : (Date.now() - this.state.p2StartTime);
            const playerDom = (playerNum === 1) ? this.dom.p1 : this.dom.p2;
            const playerIndex = (playerNum === 1) ? this.state.p1Index : this.state.p2Index;

            if (!this.state.answerLog[playerIndex]) {
                this.state.answerLog[playerIndex] = {};
            }

            Array.from(playerDom.options.children).forEach(btn => {
                btn.disabled = true;
            });
            button.classList.add('selected');

            const isCorrect = button.textContent.trim() === correctAnswer;
            this.state.answerLog[playerIndex][playerNum] = { isCorrect, timeTaken, button };

            if (this.state.answerLog[playerIndex][1] && this.state.answerLog[playerIndex][2]) {
                this.processRoundResults(playerIndex);
            }
        },
        processRoundResults(roundIndex) {
            const p1Answer = this.state.answerLog[roundIndex][1];
            const p2Answer = this.state.answerLog[roundIndex][2];
            const p1Dom = this.dom.p1;
            const p2Dom = this.dom.p2;

            p1Answer.button.classList.remove('selected');
            p2Answer.button.classList.remove('selected');

            const p1CorrectAnswerText = this.state.p1Questions[roundIndex].turkish;
            const p2CorrectAnswerText = this.state.p2Questions[roundIndex].turkish;

            Array.from(p1Dom.options.children).forEach(btn => {
                if (btn.textContent.trim() === p1CorrectAnswerText) btn.classList.add('correct');
            });
            Array.from(p2Dom.options.children).forEach(btn => {
                if (btn.textContent.trim() === p2CorrectAnswerText) btn.classList.add('correct');
            });

            p1Dom.options.classList.add('answered');
            p2Dom.options.classList.add('answered');
            if(!p1Answer.isCorrect) p1Answer.button.classList.add('incorrect', 'shake');
            if(!p2Answer.isCorrect) p2Answer.button.classList.add('incorrect', 'shake');

            if (p1Answer.isCorrect) {
                this.state.p1Score += 10;
                this.showScoreEffect(1, 10);
            }
            if (p2Answer.isCorrect) {
                this.state.p2Score += 10;
                this.showScoreEffect(2, 10);
            }

            let bonusWinner = 0;
            if (p1Answer.isCorrect && p2Answer.isCorrect) {
                if (p1Answer.timeTaken < p2Answer.timeTaken) {
                    bonusWinner = 1;
                } else if (p2Answer.timeTaken < p1Answer.timeTaken) {
                    bonusWinner = 2;
                }
            } else if (p1Answer.isCorrect) {
                bonusWinner = 1;
            } else if (p2Answer.isCorrect) {
                bonusWinner = 2;
            }

            if (bonusWinner === 1) {
                this.state.p1Score += 10;
                setTimeout(() => this.showScoreEffect(1, 10, true), 400);
            } else if (bonusWinner === 2) {
                this.state.p2Score += 10;
                setTimeout(() => this.showScoreEffect(2, 10, true), 400);
            }

            if(p1Answer.isCorrect || p2Answer.isCorrect) App.playSound('correct');
            if(!p1Answer.isCorrect || !p2Answer.isCorrect) App.playSound('incorrect');

            const p1Segments = p1Dom.progressBar.children;
            const p2Segments = p2Dom.progressBar.children;
            if(p1Segments[roundIndex]) p1Segments[roundIndex].classList.add(p1Answer.isCorrect ? 'correct' : 'incorrect');
            if(p2Segments[roundIndex]) p2Segments[roundIndex].classList.add(p2Answer.isCorrect ? 'correct' : 'incorrect');

            this.updateScoreDisplay(1);
            this.updateScoreDisplay(2);

            if(p1Segments[roundIndex]) p1Segments[roundIndex].classList.remove('active');
            if(p2Segments[roundIndex]) p2Segments[roundIndex].classList.remove('active');

            this.state.p1Timeout = setTimeout(() => {
                this.state.p1Index++;
                this.state.p2Index++;
                this.showQuestion(1);
                this.showQuestion(2);
            }, 2000);
        },
        showScoreEffect(playerNum, points, isBonus = false) {
            const container = (playerNum === 1) ? this.dom.p1.effectsContainer : this.dom.p2.effectsContainer;
            const effectEl = document.createElement('div');
            effectEl.className = 'score-effect';

            if (isBonus) {
                effectEl.classList.add('bonus');
                const lightningSVG = `<svg viewBox="0 0 24 24"><path d="M7,2V13H10V22L17,10H13L17,2H7Z" /></svg>`;
                effectEl.innerHTML = `${lightningSVG} +${points}`;
                effectEl.style.backgroundColor = 'var(--accent-color)';

                const burstContainer = document.createElement('div');
                burstContainer.className = 'burst-container';
                for (let i = 0; i < 12; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    const angle = (i / 12) * 360;
                    particle.style.setProperty('--angle', angle + 'deg');
                    burstContainer.appendChild(particle);
                }
                effectEl.appendChild(burstContainer);
            } else {
                effectEl.innerHTML = `+${points}`;
                effectEl.style.backgroundColor = 'var(--correct-color)';
            }

            container.appendChild(effectEl);

            setTimeout(() => {
                effectEl.remove();
            }, 1950);
        },
        updateScoreDisplay(playerNum) {
            const playerDom = (playerNum === 1) ? this.dom.p1 : this.dom.p2;
            const score = (playerNum === 1) ? this.state.p1Score : this.state.p2Score;
            const scoreIcon = `<svg viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg>`;
            playerDom.progress.innerHTML = `<div class="quiz-score-display">${scoreIcon}<span>${score}</span></div>`;
        },
        endGame() {
            let winner = 0;
            if (this.state.p1Score > this.state.p2Score) { winner = 1; }
            else if (this.state.p2Score > this.state.p1Score) { winner = 2; }

            this.dom.winText.className = '';
            this.dom.winnerIcon.className = '';
            this.dom.winnerIcon.innerHTML = '';

            let winnerClass = '';
            const iconSVG = `<svg viewBox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg>`;

            if (winner === 1) {
                winnerClass = 'p1-win';
                this.dom.winText.textContent = `1. Oyuncu Kazandı!`;
            }
            else if (winner === 2) {
                winnerClass = 'p2-win';
                this.dom.winText.textContent = `2. Oyuncu Kazandı!`;
            }
            else {
                winnerClass = 'draw';
                this.dom.winText.textContent = `Berabere!`;
            }

            this.dom.winText.classList.add(winnerClass);
            this.dom.winnerIcon.classList.add('winner-icon', winnerClass);

            if(winner > 0) {
                this.dom.winnerIcon.innerHTML = iconSVG;
            } else {
                this.dom.winnerIcon.innerHTML = iconSVG + iconSVG;
            }

            this.dom.gameOverContainer.classList.remove('hidden');
        }
    };

    // --- MATCH GAME MODULE ---
    const MatchGame = {
        screenId: 'match-screen',
        state: {},
        dom: {},
        init() {
            this.dom.arabicList = document.getElementById('match-arabic-list');
            this.dom.turkishList = document.getElementById('match-turkish-list');
            this.dom.overlay = document.getElementById('match-complete-overlay');
            this.dom.replayBtn = document.getElementById('play-again-match-btn');
            this.dom.replayBtn.onclick = () => { App.playSound('menuClick'); this.start(); };
        },
        start() {
            this.state = {
                pool: Utils.shuffleArray(App.getWords(true)),
                totalMatches: 0,
                initialWordCount: 7,
                gameOverTimeout: null
            };
            this.dom.overlay.classList.add('hidden');
            this.dom.arabicList.innerHTML = '';
            this.dom.turkishList.innerHTML = '';

            const wordsForGame = this.state.pool.splice(0, this.state.initialWordCount);
            if (wordsForGame.length === 0) {
                this.dom.overlay.classList.remove('hidden');
                return;
            }
            const turkishWords = Utils.shuffleArray([...wordsForGame]);

            wordsForGame.forEach(word => this.createMatchItem('arabic', word));
            turkishWords.forEach(word => this.createMatchItem('turkish', word));

            this.addDragListeners();
        },
        stop() {
            if (this.state.gameOverTimeout) clearTimeout(this.state.gameOverTimeout);
        },
        createMatchItem(type, word) {
            const el = document.createElement('div');
            el.dataset.id = word.id;
            if (type === 'arabic') {
                el.className = 'match-item';
                el.textContent = word.arabic;
                el.draggable = true;
                this.dom.arabicList.appendChild(el);
            } else {
                el.className = 'match-target';
                el.textContent = word.turkish;
                this.dom.turkishList.appendChild(el);
            }
            return el;
        },
        addDragListeners() {
            this.dom.arabicList.ondragstart = e => {
                if (e.target.classList.contains('match-item')) {
                    App.playSound('touch');
                    e.dataTransfer.setData('id', e.target.dataset.id);
                    e.target.classList.add('dragging');
                }
            };
            this.dom.arabicList.ondragend = e => {
                if (e.target.classList.contains('match-item')) e.target.classList.remove('dragging');
            };
            this.dom.turkishList.ondragover = e => {
                e.preventDefault();
                if (e.target.classList.contains('match-target') && !e.target.classList.contains('correct-match')) e.target.classList.add('drag-over');
            };
            this.dom.turkishList.ondragleave = e => {
                if (e.target.classList.contains('match-target')) e.target.classList.remove('drag-over');
            };
            this.dom.turkishList.ondrop = e => {
                e.preventDefault();
                const target = e.target;
                if (!target.classList.contains('match-target') || target.classList.contains('correct-match')) return;

                target.classList.remove('drag-over');
                const id = e.dataTransfer.getData('id');
                const item = this.dom.arabicList.querySelector(`.match-item[data-id='${id}']`);

                if (!item || item.classList.contains('correct-match')) return;

                if (target.dataset.id === id) {
                    item.draggable = false;
                    item.classList.add('correct-match');
                    target.classList.add('correct-match');
                    App.playSound('correct');
                    this.state.totalMatches++;

                    if (this.state.totalMatches === this.state.initialWordCount) {
                        this.state.gameOverTimeout = setTimeout(() => {
                            this.dom.overlay.classList.remove('hidden');
                        }, 800);
                    }
                } else {
                    App.playSound('incorrect');
                    target.classList.add('incorrect-flash');
                    setTimeout(() => target.classList.remove('incorrect-flash'), 500);
                }
            };
        }
    };

        const TypingGame = {
        screenId: 'typing-screen',
        state: {},
        dom: {},
        init() {
            this.dom.timer = document.getElementById('timer-value');
            this.dom.score = document.getElementById('score-value');
            this.dom.prompt = document.getElementById('typing-prompt');
            this.dom.input = document.getElementById('typing-input');
            this.dom.submit = document.getElementById('typing-submit-btn');
            this.dom.progressBar = document.getElementById('typing-progress-bar');
            this.dom.keyboard = document.getElementById('virtual-keyboard');
            this.dom.countdownOverlay = document.getElementById('countdown-overlay');
            this.dom.statusPanel = document.getElementById('typing-status-panel');
            this.dom.statusList = document.getElementById('typing-status-list');
            this.dom.interactiveElements = document.getElementById('typing-interactive-elements');
            this.dom.gameOverContainer = document.getElementById('typing-game-over');
            this.dom.replayBtn = document.getElementById('play-again-typing-btn');
            this.dom.effectsContainer = document.querySelector('#score-stat-item .score-effects-container-typing');

            this.dom.replayBtn.onclick = () => { App.playSound('menuClick'); this.start(); };
            this.dom.input.onkeydown = e => { if (e.key === 'Enter') this.checkAnswer(); };
            this.dom.submit.onclick = () => this.checkAnswer();
        },
        start() {
            let allWords = App.getWords(true);
            const singleWords = allWords.filter(word => !word.arabic.includes(' '));
            const finalWordList = Utils.shuffleArray(singleWords).slice(0, 10);
            const gameTime = 120;

            this.state = {
                words: finalWordList,
                currentIndex: 0,
                score: 0,
                timeLeft: gameTime,
                timer: null,
                mistakes: [],
                nextWordTimeout: null,
                totalChars: 0
            };

            this.state.totalChars = this.state.words.reduce((acc, word) => acc + word.arabic.replace(/\s/g, '').length, 0);

            this.dom.interactiveElements.style.visibility = 'visible';
            this.dom.keyboard.style.visibility = 'visible';
            this.dom.statusPanel.style.visibility = 'visible';
            this.dom.statusList.innerHTML = '';
            this.dom.gameOverContainer.classList.add('hidden');
            this.dom.score.textContent = '0';
            const minutes = Math.floor(gameTime / 60);
            const seconds = gameTime % 60;
            this.dom.timer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            this.dom.prompt.textContent = 'ابْدَأْ';
            this.dom.prompt.className = 'start-mode';
            this.dom.prompt.onclick = () => this.handleStartClick();
            this.dom.input.disabled = true;
            this.dom.input.readOnly = true;
            this.dom.input.value = '';

            this.createKeyboard();
            this.dom.spaceBar = this.dom.keyboard.querySelector('.space-bar');
            this.createProgressBar();
        },
        handleStartClick() {
            if (this.dom.prompt.classList.contains('start-mode')) {
                App.playSound('menuClick');
                this.dom.prompt.classList.remove('start-mode');
                this.dom.prompt.onclick = null;
                this.startCountdown();
            }
        },
        stop() {
            if (this.state.timer) clearInterval(this.state.timer);
            if (this.state.nextWordTimeout) clearTimeout(this.state.nextWordTimeout);
        },
        startCountdown() {
            this.dom.countdownOverlay.style.display = 'flex';
            let count = 3;
            this.dom.countdownOverlay.textContent = count;
            App.playSound('countdown');
            this.dom.prompt.textContent = '';

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    this.dom.countdownOverlay.textContent = count;
                    App.playSound('countdown');
                } else {
                    clearInterval(countdownInterval);
                    this.dom.countdownOverlay.style.display = 'none';
                    this.startGameLoop();
                }
            }, 1000);
        },
        startGameLoop() {
            this.dom.input.disabled = false;
            this.dom.input.readOnly = false;
            this.dom.input.focus();
            this.showNextWord();

            this.state.timer = setInterval(() => {
                this.state.timeLeft--;
                this.updateTimerDisplay();
                if (this.state.timeLeft < 0) {
                    this.endGame();
                }
            }, 1000);
        },
        createProgressBar() {
            this.dom.progressBar.innerHTML = '';
            this.state.words.forEach(() => {
                const segment = document.createElement('div');
                segment.className = 'progress-segment';
                this.dom.progressBar.appendChild(segment);
            });
        },
        showNextWord() {
            if (this.dom.spaceBar) this.dom.spaceBar.classList.remove('highlight-space');

            if (this.state.currentIndex >= this.state.words.length) {
                this.endGame();
                return;
            }
            const word = this.state.words[this.state.currentIndex];
            this.dom.prompt.textContent = Utils.stripHarakat(word.arabic);
            this.dom.input.value = '';
            this.dom.input.className = '';
            if (!this.dom.input.disabled) this.dom.input.focus();

            const segments = this.dom.progressBar.children;
            Array.from(segments).forEach(seg => seg.classList.remove('active'));
            if (segments[this.state.currentIndex]) segments[this.state.currentIndex].classList.add('active');
        },
        updateTimerDisplay() {
            const minutes = Math.floor(this.state.timeLeft / 60);
            const seconds = this.state.timeLeft % 60;
            this.dom.timer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        },
        checkAnswer() {
            if (this.dom.spaceBar) this.dom.spaceBar.classList.remove('highlight-space');
            if (this.dom.input.value.trim() === '' || this.dom.input.disabled) return;

            this.dom.input.disabled = true;

            const word = this.state.words[this.state.currentIndex];
            const userAnswer = this.dom.input.value.trim();
            const isCorrect = Utils.normalizeForTyping(userAnswer) === Utils.normalizeForTyping(word.arabic);

            const segments = this.dom.progressBar.children;
            if (segments[this.state.currentIndex]) {
                segments[this.state.currentIndex].classList.remove('active');
                segments[this.state.currentIndex].classList.add(isCorrect ? 'correct' : 'incorrect');
            }

            const statusLi = document.createElement('li');
            statusLi.classList.add(isCorrect ? 'correct' : 'incorrect');
            let statusHTML = `
                <div class="status-word">${Utils.stripHarakat(word.arabic)}</div>
                <div class="status-translation">${word.turkish}</div>
            `;
            if (!isCorrect) {
                statusHTML += `<div class="status-user-answer">${userAnswer}</div>`;
            }
            statusLi.innerHTML = statusHTML;
            this.dom.statusList.prepend(statusLi);

            if (isCorrect) {
                App.playSound('correct');
                let points = 0;
                if (this.state.totalChars > 0) {
                    points = (word.arabic.replace(/\s/g, '').length / this.state.totalChars) * 100;
                    this.state.score += points;
                }
                this.showScoreEffect(Math.round(points));
                this.dom.score.textContent = Math.round(this.state.score);
                this.dom.input.classList.add('correct-input');
            } else {
                App.playSound('incorrect');
                this.state.mistakes.push({ prompt: word.arabic, incorrect: userAnswer, correct: word.arabic });
                this.dom.input.classList.add('incorrect-input');
            }

            this.state.currentIndex++;
            this.state.nextWordTimeout = setTimeout(() => {
                this.dom.input.disabled = false;
                this.showNextWord();
            }, 1200);
        },
        endGame() {
            if (this.dom.spaceBar) this.dom.spaceBar.classList.remove('highlight-space');
            if (this.state.timer) clearInterval(this.state.timer);
            if (this.state.nextWordTimeout) clearTimeout(this.state.nextWordTimeout);
            this.dom.input.disabled = true;
            this.dom.interactiveElements.style.visibility = 'hidden';
            this.dom.keyboard.style.visibility = 'hidden';
            this.dom.statusPanel.style.visibility = 'hidden';
            this.dom.gameOverContainer.classList.remove('hidden');
        },
        showScoreEffect(points) {
            if (!this.dom.effectsContainer || points <= 0) return;
            const effectEl = document.createElement('div');
            effectEl.className = 'typing-score-effect';
            effectEl.textContent = `+${points}`;

            this.dom.effectsContainer.appendChild(effectEl);

            setTimeout(() => {
                effectEl.remove();
            }, 1450);
        },
        createKeyboard() {
            if(this.dom.keyboard.innerHTML !== '') return;

            const colorMap = {
                'ب': '#a0c4ff', 'ت': '#a0c4ff', 'ث': '#a0c4ff', 'ن': '#a0c4ff', 'ي': '#a0c4ff',
                'ج': '#caffbf', 'ح': '#caffbf', 'خ': '#caffbf',
                'د': '#fdffb6', 'ذ': '#fdffb6',
                'ر': '#ffd6a5', 'ز': '#ffd6a5',
                'س': '#ffadad', 'ش': '#ffadad',
                'ص': '#bdb2ff', 'ض': '#bdb2ff',
                'ط': '#9bf6ff', 'ظ': '#9bf6ff',
                'ع': '#ffc6ff', 'غ': '#ffc6ff',
                'ف': '#b9f6ca', 'ق': '#b9f6ca',
                'ه': '#b3e5fc', 'ة': '#b3e5fc',
                'ء': '#ffccbc', 'ؤ': '#ffccbc', 'ئ': '#ffccbc',
                'ا': '#e0e0e0', 'ل': '#e0e0e0',
                'ك': '#d1c4e9',
                'م': '#f8bbd0',
                'و': '#c5cae9',
            };
            const defaultColor = '#FFFFFF';

            const keys = [
                ["د", "ج", "ح", "خ", "ه", "ع", "غ", "ف", "ق", "ث", "ص", "ض"],
                ["ط", "ك", "م", "ن", "ت", "ا", "ل", "ب", "ي", "س", "ش", "ذ"],
                ["ظ", "ز", "و", "ة", "ى", "ر", "ؤ", "ء", "ئ"]
            ];
            keys.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                row.forEach(key => {
                    const keyBtn = document.createElement('button');
                    keyBtn.className = 'keyboard-key';
                    keyBtn.textContent = key;

                    const bgColor = colorMap[key] || defaultColor;
                    const shadowColor = this.getDarkerColor(bgColor);
                    keyBtn.style.backgroundColor = bgColor;
                    keyBtn.style.boxShadow = `0 4px ${shadowColor}`;
                    keyBtn.onmousedown = () => { keyBtn.style.transform = 'translateY(2px)'; keyBtn.style.boxShadow = `0 2px ${shadowColor}`; };
                    keyBtn.onmouseup = () => { keyBtn.style.transform = ''; keyBtn.style.boxShadow = `0 4px ${shadowColor}`; };
                    keyBtn.onmouseleave = () => { keyBtn.style.transform = ''; keyBtn.style.boxShadow = `0 4px ${shadowColor}`; };
                    rowDiv.appendChild(keyBtn);
                });
                this.dom.keyboard.appendChild(rowDiv);
            });
            const specialRow = document.createElement('div');
            specialRow.className = 'keyboard-row';
            const spaceBtn = document.createElement('button');
            spaceBtn.className = 'keyboard-key space-bar';
            spaceBtn.textContent = 'مسافة';
            spaceBtn.style.flexGrow = '8';
            const spaceBg = '#CFD8DC';
            const spaceShadow = this.getDarkerColor(spaceBg);
            spaceBtn.style.backgroundColor = spaceBg;
            spaceBtn.style.boxShadow = `0 4px ${spaceShadow}`;
            spaceBtn.onmousedown = () => { spaceBtn.style.transform = 'translateY(2px)'; spaceBtn.style.boxShadow = `0 2px ${spaceShadow}`; };
            spaceBtn.onmouseup = () => { spaceBtn.style.transform = ''; spaceBtn.style.boxShadow = `0 4px ${spaceShadow}`; }; // Düzeltme: keyBtn -> spaceBtn

            const backspaceBtn = document.createElement('button');
            backspaceBtn.className = 'keyboard-key backspace'; backspaceBtn.style.flexGrow = '2';
            backspaceBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M22,3H7C6.31,3 5.77,3.35 5.41,3.88L0,12L5.41,20.11C5.77,20.64 6.31,21 7,21H22A2,2 0 0,0 24,19V5A2,2 0 0,0 22,3M19,15.59L17.59,17L14,13.41L10.41,17L9,15.59L12.59,12L9,8.41L10.41,7L14,10.59L17.59,7L19,8.41L15.41,12L19,15.59Z" /></svg>`;
            const backspaceShadow = this.getDarkerColor('#FFCA28');
            backspaceBtn.style.boxShadow = `0 4px ${backspaceShadow}`;
            backspaceBtn.onmousedown = () => { backspaceBtn.style.transform = 'translateY(2px)'; backspaceBtn.style.boxShadow = `0 2px ${backspaceShadow}`; };
            backspaceBtn.onmouseup = () => { backspaceBtn.style.transform = ''; backspaceBtn.style.boxShadow = `0 4px ${backspaceShadow}`; };

            specialRow.appendChild(backspaceBtn);
            specialRow.appendChild(spaceBtn);
            this.dom.keyboard.appendChild(specialRow);

            this.dom.keyboard.onclick = (e) => {
                if (this.dom.input.disabled) return;
                const keyEl = e.target.closest('.keyboard-key');
                if (!keyEl) return;
                App.playSound('touch');
                if (keyEl.classList.contains('backspace')) this.dom.input.value = this.dom.input.value.slice(0, -1);
                else if (keyEl.classList.contains('space-bar')) this.dom.input.value += ' ';
                else this.dom.input.value += keyEl.textContent;
                //this.dom.input.focus(); // Mobil cihazlarda odak sorunları yaratabilir
            };
        },
        getDarkerColor(hex) {
            if(hex.length === 4) {
                hex = '#' + hex[1] + hex[1] + hex[2] + hex[2] + hex[3] + hex[3];
            }
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            r = Math.max(0, Math.floor(r * 0.85));
            g = Math.max(0, Math.floor(g * 0.85));
            b = Math.max(0, Math.floor(b * 0.85));
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }


    };

    App.init();

    });

    </script>
</body>
</html>